!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?module.exports=factory(require("jquery")):factory(window.jQuery)}(function($){"use strict";$.fn.fileinputLocales={},$.fn.fileinputThemes={},String.prototype.setTokens=function(replacePairs){var key,re,str=this.toString();for(key in replacePairs)replacePairs.hasOwnProperty(key)&&(re=new RegExp("{"+key+"}","g"),str=str.replace(re,replacePairs[key]));return str};var $h,FileInput;$h={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(input,str,exact){return void 0!==input&&(exact?input===str:input.match(str))},isIE:function(ver){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===ver)return new RegExp("msie\\s"+ver,"i").test(navigator.userAgent);var status,div=document.createElement("div");return div.innerHTML="\x3c!--[if IE "+ver+"]> <i></i> <![endif]--\x3e",status=div.getElementsByTagName("i").length,document.body.appendChild(div),div.parentNode.removeChild(div),status},initModal:function($modal){var $body=$("body");$body.length&&$modal.appendTo($body)},isEmpty:function(value,trim){return void 0===value||null===value||0===value.length||trim&&""===$.trim(value)},isArray:function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},ifSet:function(needle,haystack,def){return def=def||"",haystack&&"object"==typeof haystack&&needle in haystack?haystack[needle]:def},cleanArray:function(arr){return arr instanceof Array||(arr=[]),arr.filter(function(e){return void 0!==e&&null!==e})},spliceArray:function(arr,index){var i,j=0,out=[];if(!(arr instanceof Array))return[];for(i=0;i<arr.length;i++)i!==index&&(out[j]=arr[i],j++);return out},getNum:function(num,def){return def=def||0,"number"==typeof num?num:("string"==typeof num&&(num=parseFloat(num)),isNaN(num)?def:num)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var div=document.createElement("div");return!$h.isIE(9)&&(void 0!==div.draggable||void 0!==div.ondragstart&&void 0!==div.ondrop)},hasFileUploadSupport:function(){return $h.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(e){return!1}},hasArrayBufferViewSupport:function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}},dataURI2Blob:function(dataURI){var byteStr,arrayBuffer,intArray,i,mimeStr,bb,BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,canBlob=$h.hasBlobSupport();if(!((canBlob||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return null;for(byteStr=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):decodeURIComponent(dataURI.split(",")[1]),arrayBuffer=new ArrayBuffer(byteStr.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteStr.length;i+=1)intArray[i]=byteStr.charCodeAt(i);return mimeStr=dataURI.split(",")[0].split(":")[1].split(";")[0],canBlob?new Blob([$h.hasArrayBufferViewSupport()?intArray:arrayBuffer],{type:mimeStr}):((bb=new BlobBuilder).append(arrayBuffer),bb.getBlob(mimeStr))},addCss:function($el,css){$el.removeClass(css).addClass(css)},getElement:function(options,param,value){return $h.isEmpty(options)||$h.isEmpty(options[param])?value:$(options[param])},uniqId:function(){return Math.round((new Date).getTime())+"_"+Math.round(100*Math.random())},htmlEncode:function(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(str,tags){var out=str;return tags?($.each(tags,function(key,value){"function"==typeof value&&(value=value()),out=out.split(key).join(value)}),out):out},cleanMemory:function($thumb){var data=$thumb.is("img")?$thumb.attr("src"):$thumb.find("source").attr("src");$h.objUrl.revokeObjectURL(data)},findFileName:function(filePath){var sepIndex=filePath.lastIndexOf("/");return-1===sepIndex&&(sepIndex=filePath.lastIndexOf("\\")),filePath.split(filePath.substring(sepIndex,sepIndex+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(maximize){var doc=document,de=doc.documentElement;de&&maximize&&!$h.checkFullScreen()?de.requestFullscreen?de.requestFullscreen():de.msRequestFullscreen?de.msRequestFullscreen():de.mozRequestFullScreen?de.mozRequestFullScreen():de.webkitRequestFullscreen&&de.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):doc.exitFullscreen?doc.exitFullscreen():doc.msExitFullscreen?doc.msExitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitExitFullscreen&&doc.webkitExitFullscreen()},moveArray:function(arr,oldIndex,newIndex){if(newIndex>=arr.length)for(var k=newIndex-arr.length;1+k--;)arr.push(void 0);return arr.splice(newIndex,0,arr.splice(oldIndex,1)[0]),arr},cleanZoomCache:function($el){var $cache=$el.closest(".kv-zoom-cache-theme");$cache.length||($cache=$el.closest(".kv-zoom-cache")),$cache.remove()},setOrientation:function(buffer,callback){var maxBytes,uInt16,scanner=new DataView(buffer),idx=0,value=1;if(65496!==scanner.getUint16(idx)||buffer.length<2)callback&&callback();else{for(idx+=2,maxBytes=scanner.byteLength;idx<maxBytes-2;)switch(uInt16=scanner.getUint16(idx),idx+=2,uInt16){case 65505:maxBytes=scanner.getUint16(idx)-idx,idx+=2;break;case 274:value=scanner.getUint16(idx+6,!1),maxBytes=0}callback&&callback(value)}},validateOrientation:function(file,callback){if(window.FileReader&&window.DataView){var buffer,reader=new FileReader;reader.onloadend=function(){buffer=reader.result,$h.setOrientation(buffer,callback)},reader.readAsArrayBuffer(file)}},adjustOrientedImage:function($img,isZoom){var newTop;$img.hasClass("is-portrait-gt4")&&(isZoom?$img.css({width:$img.parent().height()}):($img.css({height:"auto",width:$img.height()}),newTop=$img.parent().offset().top-$img.offset().top,$img.css("margin-top",newTop)))}},(FileInput=function(element,options){var self=this;self.$element=$(element),self.$parent=self.$element.parent(),self._validate()&&(self.isPreviewable=$h.hasFileAPISupport(),self.isIE9=$h.isIE(9),self.isIE10=$h.isIE(10),(self.isPreviewable||self.isIE9)&&(self._init(options),self._listen()),self.$element.removeClass("file-loading"))}).prototype={constructor:FileInput,_cleanup:function(){var self=this;self.reader=null,self.formdata={},self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.uploadAsyncCount=0,self.loadedImages=[],self.totalImagesCount=0,self.ajaxRequests=[],self.clearStack(),self.fileInputCleared=!1,self.fileBatchCompleted=!0,self.isPreviewable||(self.showPreview=!1),self.isError=!1,self.ajaxAborted=!1,self.cancelling=!1},_init:function(options,refreshMode){var $cont,t,tmp,self=this,$el=self.$element;self.options=options,$.each(options,function(key,value){switch(key){case"minFileCount":case"maxFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":self[key]=$h.getNum(value);break;default:self[key]=value}}),self.rtl&&(tmp=self.previewZoomButtonIcons.prev,self.previewZoomButtonIcons.prev=self.previewZoomButtonIcons.next,self.previewZoomButtonIcons.next=tmp),refreshMode||self._cleanup(),self.$form=$el.closest("form"),self._initTemplateDefaults(),self.uploadFileAttr=$h.isEmpty($el.attr("name"))?"file_data":$el.attr("name"),t=self._getLayoutTemplate("progress"),self.progressTemplate=t.replace("{class}",self.progressClass),self.progressCompleteTemplate=t.replace("{class}",self.progressCompleteClass),self.progressErrorTemplate=t.replace("{class}",self.progressErrorClass),self.dropZoneEnabled=$h.hasDragDropSupport()&&self.dropZoneEnabled,self.isDisabled=$el.attr("disabled")||$el.attr("readonly"),self.isDisabled&&$el.attr("disabled",!0),self.isUploadable=$h.hasFileUploadSupport()&&!$h.isEmpty(self.uploadUrl),self.isClickable=self.browseOnZoneClick&&self.showPreview&&(self.isUploadable&&self.dropZoneEnabled||!$h.isEmpty(self.defaultPreviewContent)),self.slug="function"==typeof options.slugCallback?options.slugCallback:self._slugDefault,self.mainTemplate=self.showCaption?self._getLayoutTemplate("main1"):self._getLayoutTemplate("main2"),self.captionTemplate=self._getLayoutTemplate("caption"),self.previewGenericTemplate=self._getPreviewTemplate("generic"),!self.imageCanvas&&self.resizeImage&&(self.maxImageWidth||self.maxImageHeight)&&(self.imageCanvas=document.createElement("canvas"),self.imageCanvasContext=self.imageCanvas.getContext("2d")),$h.isEmpty($el.attr("id"))&&$el.attr("id",$h.uniqId()),self.namespace=".fileinput_"+$el.attr("id").replace(/-/g,"_"),void 0===self.$container?self.$container=self._createContainer():self._refreshContainer(),$cont=self.$container,self.$dropZone=$cont.find(".file-drop-zone"),self.$progress=$cont.find(".kv-upload-progress"),self.$btnUpload=$cont.find(".fileinput-upload"),self.$captionContainer=$h.getElement(options,"elCaptionContainer",$cont.find(".file-caption")),self.$caption=$h.getElement(options,"elCaptionText",$cont.find(".file-caption-name")),self.$previewContainer=$h.getElement(options,"elPreviewContainer",$cont.find(".file-preview")),self.$preview=$h.getElement(options,"elPreviewImage",$cont.find(".file-preview-thumbnails")),self.$previewStatus=$h.getElement(options,"elPreviewStatus",$cont.find(".file-preview-status")),self.$errorContainer=$h.getElement(options,"elErrorContainer",self.$previewContainer.find(".kv-fileinput-error")),$h.isEmpty(self.msgErrorClass)||$h.addCss(self.$errorContainer,self.msgErrorClass),refreshMode||(self.$errorContainer.hide(),self.previewInitId="preview-"+$h.uniqId(),self._initPreviewCache(),self._initPreview(!0),self._initPreviewActions(),self._setFileDropZoneTitle(),self.$parent.hasClass("file-loading")&&(self.$container.insertBefore(self.$parent),self.$parent.remove())),$el.attr("disabled")&&self.disable(),self._initZoom(),self.hideThumbnailContent&&$h.addCss(self.$preview,"hide-content")},_initTemplateDefaults:function(){var tMain1,tMain2,tPreview,tFileIcon,tClose,tCaption,tBtnDefault,tBtnLink,tBtnBrowse,tModalMain,tModal,tProgress,tSize,tFooter,tActions,tActionDelete,tActionUpload,tActionDownload,tActionZoom,tActionDrag,tIndicator,tTagBef,tTagBef1,tTagBef2,tTagAft,tHtml,tImage,tText,tVideo,tAudio,tFlash,tObject,tPdf,tOther,tZoomCache,vDefaultDim,self=this;tMain1='{preview}\n<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {browse}\n   </div>\n</div>',tMain2='{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',tPreview='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',tClose='<button type="button" class="close fileinput-remove">&times;</button>\n',tFileIcon='<i class="glyphicon glyphicon-file kv-caption-icon"></i>',tCaption='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"></div>\n</div>\n',tBtnDefault='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',tBtnLink='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',tBtnBrowse='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',tModalMain='<div id="'+$h.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+$h.MODAL_ID+'Label"></div>',tModal='<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h5 class="modal-title">{heading}</h5>\n      <span class="kv-zoom-title"></span>\n      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}</div>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',tProgress='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>',tSize=" <samp>({sizeText})</samp>",tFooter='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">\n        <div class="file-caption-info">{caption}</div>\n        <div class="file-size-info">{size}</div>\n    </div>\n    {progress}\n{indicator}\n{actions}\n</div>',tActions='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {download} {upload} {delete} {zoom} {other}    </div>\n</div>\n{drag}\n<div class="clearfix"></div>',tActionDelete='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',tActionUpload='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',tActionDownload='<a href="{downloadUrl}" class="{downloadClass}" title="{downloadTitle}" download="{caption}">{downloadIcon}</a>',tActionZoom='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',tActionDrag='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',tIndicator='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>',tTagBef1=(tTagBef='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"')+'><div class="kv-file-content">\n',tTagBef2=tTagBef+' title="{caption}"><div class="kv-file-content">\n',tTagAft="</div>{footer}\n</div>\n",tHtml='<div class="kv-preview-data file-preview-html" title="{caption}" {style}>{data}</div>\n',tImage='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" {style}>\n',tText='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly {style}>{data}</textarea {style}>\n',tVideo='<video class="kv-preview-data file-preview-video" controls {style}>\n<source src="{data}" type="{type}">\n'+$h.DEFAULT_PREVIEW+"\n</video>\n",tAudio='<audio class="kv-preview-data file-preview-audio" controls {style}>\n<source src="{data}" type="{type}">\n'+$h.DEFAULT_PREVIEW+"\n</audio>\n",tFlash='<object class="kv-preview-data file-preview-flash file-object" type="application/x-shockwave-flash" data="{data}" {style}>\n'+$h.OBJECT_PARAMS+" "+$h.DEFAULT_PREVIEW+"\n</object>\n",tObject='<object class="kv-preview-data file-preview-object file-object {typeCss}" data="{data}" type="{type}" {style}>\n<param name="movie" value="{caption}" />\n'+$h.OBJECT_PARAMS+" "+$h.DEFAULT_PREVIEW+"\n</object>\n",tPdf='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf" {style}>\n',tOther='<div class="kv-preview-data file-preview-other-frame" {style}>\n'+$h.DEFAULT_PREVIEW+"\n</div>\n",tZoomCache='<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>',vDefaultDim={width:"100%",height:"100%","min-height":"480px"},self.defaults={layoutTemplates:{main1:tMain1,main2:tMain2,preview:tPreview,close:tClose,fileIcon:tFileIcon,caption:tCaption,modalMain:tModalMain,modal:tModal,progress:tProgress,size:tSize,footer:tFooter,indicator:tIndicator,actions:tActions,actionDelete:tActionDelete,actionUpload:tActionUpload,actionDownload:tActionDownload,actionZoom:tActionZoom,actionDrag:tActionDrag,btnDefault:tBtnDefault,btnLink:tBtnLink,btnBrowse:tBtnBrowse,zoomCache:tZoomCache},previewMarkupTags:{tagBefore1:tTagBef1,tagBefore2:tTagBef2,tagAfter:tTagAft},previewContentTemplates:{generic:"{content}\n",html:tHtml,image:tImage,text:tText,video:tVideo,audio:tAudio,flash:tFlash,object:tObject,pdf:tPdf,other:tOther},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"213px",height:"160px"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:vDefaultDim,text:vDefaultDim,video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:vDefaultDim,other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(vType,vName){return $h.compare(vType,"image.*")||$h.compare(vName,/\.(gif|png|jpe?g)$/i)},html:function(vType,vName){return $h.compare(vType,"text/html")||$h.compare(vName,/\.(htm|html)$/i)},text:function(vType,vName){return $h.compare(vType,"text.*")||$h.compare(vName,/\.(xml|javascript)$/i)||$h.compare(vName,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(vType,vName){return $h.compare(vType,"video.*")&&($h.compare(vType,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||$h.compare(vName,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(vType,vName){return $h.compare(vType,"audio.*")&&($h.compare(vName,/(ogg|mp3|mp?g|wav)$/i)||$h.compare(vName,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(vType,vName){return $h.compare(vType,"application/x-shockwave-flash",!0)||$h.compare(vName,/\.(swf)$/i)},pdf:function(vType,vName){return $h.compare(vType,"application/pdf",!0)||$h.compare(vName,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-sm btn-default btn-outline-secondary",removeErrorClass:"btn btn-sm btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-sm btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="glyphicon glyphicon-download"></i>',downloadClass:"btn btn-sm btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-sm btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-move"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}},$.each(self.defaults,function(key,setting){"allowedPreviewTypes"!==key?self[key]=$.extend(!0,{},setting,self[key]):void 0===self.allowedPreviewTypes&&(self.allowedPreviewTypes=setting)}),self._initPreviewTemplates()},_initPreviewTemplates:function(){var tagBef,self=this,cfg=self.defaults,tags=self.previewMarkupTags,tagAft=tags.tagAfter;$.each(cfg.previewContentTemplates,function(key,value){$h.isEmpty(self.previewTemplates[key])&&(tagBef=tags.tagBefore2,"generic"!==key&&"image"!==key&&"html"!==key&&"text"!==key||(tagBef=tags.tagBefore1),self.previewTemplates[key]=tagBef+value+tagAft)})},_initPreviewCache:function(){var self=this;self.previewCache={data:{},init:function(){var content=self.initialPreview;content.length>0&&!$h.isArray(content)&&(content=content.split(self.initialPreviewDelimiter)),self.previewCache.data={content:content,config:self.initialPreviewConfig,tags:self.initialPreviewThumbTags}},count:function(){return self.previewCache.data&&self.previewCache.data.content?self.previewCache.data.content.length:0},get:function(i,isDisabled){var out,$tmp,cat,ftr,fname,ftype,frameClass,ind="init_"+i,data=self.previewCache.data,config=data.config[i],content=data.content[i],previewId=self.previewInitId+"-"+ind,asData=$h.ifSet("previewAsData",config,self.initialPreviewAsData),parseTemplate=function(cat,dat,fn,ft,id,ftr,ind,fc,t){return fc=" file-preview-initial "+$h.SORT_CSS+(fc?" "+fc:""),self._generatePreviewTemplate(cat,dat,fn,ft,id,!1,null,fc,ftr,ind,t)};return content?(isDisabled=void 0===isDisabled||isDisabled,cat=$h.ifSet("type",config,self.initialPreviewFileType||"generic"),fname=$h.ifSet("filename",config,$h.ifSet("caption",config)),ftype=$h.ifSet("filetype",config,cat),ftr=self.previewCache.footer(i,isDisabled,config&&config.size||null),frameClass=$h.ifSet("frameClass",config),out=asData?parseTemplate(cat,content,fname,ftype,previewId,ftr,ind,frameClass):parseTemplate("generic",content,fname,ftype,previewId,ftr,ind,frameClass,cat).setTokens({content:data.content[i]}),data.tags.length&&data.tags[i]&&(out=$h.replaceTags(out,data.tags[i])),$h.isEmpty(config)||$h.isEmpty(config.frameAttr)||(($tmp=$(document.createElement("div")).html(out)).find(".file-preview-initial").attr(config.frameAttr),out=$tmp.html(),$tmp.remove()),out):""},add:function(content,config,tags,append){var index,data=self.previewCache.data;return $h.isArray(content)||(content=content.split(self.initialPreviewDelimiter)),append?(index=data.content.push(content)-1,data.config[index]=config,data.tags[index]=tags):(index=content.length-1,data.content=content,data.config=config,data.tags=tags),self.previewCache.data=data,index},set:function(content,config,tags,append){var i,data=self.previewCache.data;if(content&&content.length&&($h.isArray(content)||(content=content.split(self.initialPreviewDelimiter)),content.filter(function(n){return null!==n}).length)){if(void 0===data.content&&(data.content=[]),void 0===data.config&&(data.config=[]),void 0===data.tags&&(data.tags=[]),append){for(i=0;i<content.length;i++)content[i]&&data.content.push(content[i]);for(i=0;i<config.length;i++)config[i]&&data.config.push(config[i]);for(i=0;i<tags.length;i++)tags[i]&&data.tags.push(tags[i])}else data.content=content,data.config=config,data.tags=tags;self.previewCache.data=data}},unset:function(index){var chk=self.previewCache.count();if(chk){if(1===chk)return self.previewCache.data.content=[],self.previewCache.data.config=[],self.previewCache.data.tags=[],self.initialPreview=[],self.initialPreviewConfig=[],void(self.initialPreviewThumbTags=[]);self.previewCache.data.content.splice(index,1),self.previewCache.data.config.splice(index,1),self.previewCache.data.tags.splice(index,1)}},out:function(){var caption,i,html="",len=self.previewCache.count();if(0===len)return{content:"",caption:""};for(i=0;i<len;i++)html+=self.previewCache.get(i);return caption=self._getMsgSelected(len),{content:html,caption:caption}},footer:function(i,isDisabled,size){var data=self.previewCache.data;if(!data||!data.config||0===data.config.length||$h.isEmpty(data.config[i]))return"";isDisabled=void 0===isDisabled||isDisabled;var a,config=data.config[i],caption=$h.ifSet("caption",config),width=$h.ifSet("width",config,"auto"),url=$h.ifSet("url",config,!1),key=$h.ifSet("key",config,null),fs=self.fileActionSettings,initPreviewShowDel=self.initialPreviewShowDelete||!1,dUrl=config.downloadUrl||self.initialPreviewDownloadUrl||"",dFil=config.filename||config.caption||"",initPreviewShowDwl=!!dUrl,sDel=$h.ifSet("showDelete",config,$h.ifSet("showDelete",fs,initPreviewShowDel)),sDwl=$h.ifSet("showDownload",config,$h.ifSet("showDownload",fs,initPreviewShowDwl)),sZm=$h.ifSet("showZoom",config,$h.ifSet("showZoom",fs,!0)),sDrg=$h.ifSet("showDrag",config,$h.ifSet("showDrag",fs,!0)),dis=!1===url&&isDisabled;return sDwl=sDwl&&!1!==config.downloadUrl&&!!dUrl,a=self._renderFileActions(!1,sDwl,sDel,sZm,sDrg,dis,url,key,!0,dUrl,dFil),self._getLayoutTemplate("footer").setTokens({progress:self._renderThumbProgress(),actions:a,caption:caption,size:self._getSize(size),width:width,indicator:""})}},self.previewCache.init()},_handler:function($el,event,callback){var ns=this.namespace,ev=event.split(" ").join(ns+" ")+ns;$el&&$el.length&&$el.off(ev).on(ev,callback)},_log:function(msg){var id=this.$element.attr("id");id&&(msg='"'+id+'": '+msg),void 0!==window.console.log?window.console.log(msg):window.alert(msg)},_validate:function(){var self=this,status="file"===self.$element.attr("type");return status||self._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),status},_errorsExist:function(){var $err,self=this;return!!self.$errorContainer.find("li").length||(($err=$(document.createElement("div")).html(self.$errorContainer.html())).find(".kv-error-close").remove(),$err.find("ul").remove(),!!$.trim($err.text()).length)},_errorHandler:function(evt,caption){var self=this,err=evt.target.error,showError=function(msg){self._showError(msg.replace("{name}",caption))};showError(err.code===err.NOT_FOUND_ERR?self.msgFileNotFound:err.code===err.SECURITY_ERR?self.msgFileSecured:err.code===err.NOT_READABLE_ERR?self.msgFileNotReadable:err.code===err.ABORT_ERR?self.msgFilePreviewAborted:self.msgFilePreviewError)},_addError:function(msg){var self=this,$error=self.$errorContainer;msg&&$error.length&&($error.html(self.errorCloseButton+msg),self._handler($error.find(".kv-error-close"),"click",function(){$error.fadeOut("slow")}))},_resetErrors:function(fade){var self=this,$error=self.$errorContainer;self.isError=!1,self.$container.removeClass("has-error"),$error.html(""),fade?$error.fadeOut("slow"):$error.hide()},_showFolderError:function(folders){var msg,self=this,$error=self.$errorContainer;folders&&(msg=self.msgFoldersNotAllowed.replace("{n}",folders),self._addError(msg),$h.addCss(self.$container,"has-error"),$error.fadeIn(800),self._raise("filefoldererror",[folders,msg]))},_showUploadError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileuploaderror",e=params&&params.id?'<li data-file-id="'+params.id+'">'+msg+"</li>":"<li>"+msg+"</li>";return 0===$error.find("ul").length?self._addError("<ul>"+e+"</ul>"):$error.find("ul").append(e),$error.fadeIn(800),self._raise(ev,[params,msg]),self.$container.removeClass("file-input-new"),$h.addCss(self.$container,"has-error"),!0},_showError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileerror";return params=params||{},params.reader=self.reader,self._addError(msg),$error.fadeIn(800),self._raise(ev,[params,msg]),self.isUploadable||self._clearFileInput(),self.$container.removeClass("file-input-new"),$h.addCss(self.$container,"has-error"),self.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(params){var self=this,label=self.minFileCount>1?self.filePlural:self.fileSingle,msg=self.msgFilesTooLess.replace("{n}",self.minFileCount).replace("{files}",label),$error=self.$errorContainer;self._addError(msg),self.isError=!0,self._updateFileDetails(0),$error.fadeIn(800),self._raise("fileerror",[params,msg]),self._clearFileInput(),$h.addCss(self.$container,"has-error")},_parseError:function(operation,jqXHR,errorThrown,fileName){var textPre,self=this,errMsg=$.trim(errorThrown+""),text=void 0!==jqXHR.responseJSON&&void 0!==jqXHR.responseJSON.error?jqXHR.responseJSON.error:jqXHR.responseText;return self.cancelling&&self.msgUploadAborted&&(errMsg=self.msgUploadAborted),self.showAjaxErrorDetails&&text&&(textPre=(text=$.trim(text.replace(/\n\s*\n/g,"\n"))).length?"<pre>"+text+"</pre>":"",errMsg+=errMsg?textPre:text),errMsg||(errMsg=self.msgAjaxError.replace("{operation}",operation)),self.cancelling=!1,fileName?"<b>"+fileName+": </b>"+errMsg:errMsg},_parseFileType:function(file){var isValid,vType,cat,i,self=this,types=self.allowedPreviewTypes||[];for(i=0;i<types.length;i++)if(cat=types[i],isValid=self.fileTypeSettings[cat],vType=isValid(file.type,file.name)?cat:"",!$h.isEmpty(vType))return vType;return"other"},_getPreviewIcon:function(fname){var ext,self=this,out=null;return fname&&fname.indexOf(".")>-1&&(ext=fname.split(".").pop(),self.previewFileIconSettings&&(out=self.previewFileIconSettings[ext]||self.previewFileIconSettings[ext.toLowerCase()]||null),self.previewFileExtSettings&&$.each(self.previewFileExtSettings,function(key,func){self.previewFileIconSettings[key]&&func(ext)&&(out=self.previewFileIconSettings[key])})),out},_parseFilePreviewIcon:function(content,fname){var self=this,icn=self._getPreviewIcon(fname)||self.previewFileIcon,out=content;return out.indexOf("{previewFileIcon}")>-1&&(out=out.setTokens({previewFileIconClass:self.previewFileIconClass,previewFileIcon:icn})),out},_raise:function(event,params){var self=this,e=$.Event(event);if(void 0!==params?self.$element.trigger(e,params):self.$element.trigger(e),e.isDefaultPrevented()||!1===e.result)return!1;switch(event){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:self.ajaxAborted||(self.ajaxAborted=e.result)}return!0},_listenFullScreen:function(isFullScreen){var $btnFull,$btnBord,self=this,$modal=self.$modal;$modal&&$modal.length&&($btnFull=$modal&&$modal.find(".btn-fullscreen"),$btnBord=$modal&&$modal.find(".btn-borderless"),$btnFull.length&&$btnBord.length&&($btnFull.removeClass("active").attr("aria-pressed","false"),$btnBord.removeClass("active").attr("aria-pressed","false"),isFullScreen?$btnFull.addClass("active").attr("aria-pressed","true"):$btnBord.addClass("active").attr("aria-pressed","true"),$modal.hasClass("file-zoom-fullscreen")?self._maximizeZoomDialog():isFullScreen?self._maximizeZoomDialog():$btnBord.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var fullScreenEvents,self=this,$el=self.$element,$form=self.$form,$cont=self.$container;self._handler($el,"change",$.proxy(self._change,self)),self.showBrowse&&self._handler(self.$btnFile,"click",$.proxy(self._browse,self)),self._handler($cont.find(".fileinput-remove:not([disabled])"),"click",$.proxy(self.clear,self)),self._handler($cont.find(".fileinput-cancel"),"click",$.proxy(self.cancel,self)),self._initDragDrop(),self._handler($form,"reset",$.proxy(self.clear,self)),self.isUploadable||self._handler($form,"submit",$.proxy(self._submitForm,self)),self._handler(self.$container.find(".fileinput-upload"),"click",$.proxy(self._uploadClick,self)),self._handler($(window),"resize",function(){self._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),fullScreenEvents="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",self._handler($(document),fullScreenEvents,function(){self._listenFullScreen($h.checkFullScreen())}),self._autoFitContent(),self._initClickable()},_autoFitContent:function(){var sel,self=this,config=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<400?self.previewSettingsSmall||self.defaults.previewSettingsSmall:self.previewSettings||self.defaults.previewSettings;$.each(config,function(cat,settings){sel=".file-preview-frame .file-preview-"+cat,self.$preview.find(sel+".kv-preview-data,"+sel+" .kv-preview-data").css(settings)})},_initClickable:function(){var $zone,self=this;self.isClickable&&($zone=self.isUploadable?self.$dropZone:self.$preview.find(".file-default-preview"),$h.addCss($zone,"clickable"),$zone.attr("tabindex",-1),self._handler($zone,"click",function(e){var $tar=$(e.target);$tar.parents(".file-preview-thumbnails").length&&!$tar.parents(".file-default-preview").length||(self.$element.trigger("click"),$zone.blur())}))},_initDragDrop:function(){var self=this,$zone=self.$dropZone;self.isUploadable&&self.dropZoneEnabled&&self.showPreview&&(self._handler($zone,"dragenter dragover",$.proxy(self._zoneDragEnter,self)),self._handler($zone,"dragleave",$.proxy(self._zoneDragLeave,self)),self._handler($zone,"drop",$.proxy(self._zoneDrop,self)),self._handler($(document),"dragenter dragover drop",self._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(e){var self=this,hasFiles=$.inArray("Files",e.originalEvent.dataTransfer.types)>-1;if(self._zoneDragDropInit(e),self.isDisabled||!hasFiles)return e.originalEvent.dataTransfer.effectAllowed="none",void(e.originalEvent.dataTransfer.dropEffect="none");$h.addCss(self.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){var self=this;self._zoneDragDropInit(e),self.isDisabled||self.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var self=this;e.preventDefault(),self.isDisabled||$h.isEmpty(e.originalEvent.dataTransfer.files)||(self._change(e,"dragdrop"),self.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(e){var $form,self=this,$btn=self.$container.find(".fileinput-upload"),isEnabled=!$btn.hasClass("disabled")&&$h.isEmpty($btn.attr("disabled"));e&&e.isDefaultPrevented()||(self.isUploadable?(e.preventDefault(),isEnabled&&self.upload()):isEnabled&&"submit"!==$btn.attr("type")&&(($form=$btn.closest("form")).length&&$form.trigger("submit"),e.preventDefault()))},_submitForm:function(){var self=this;return self._isFileSelectionValid()&&!self._abort({})},_clearPreview:function(){var self=this,$p=self.$preview;(self.showUploadedThumbs?self.getFrames(":not(.file-preview-success)"):self.getFrames()).each(function(){var $thumb=$(this);$thumb.remove(),$h.cleanZoomCache($p.find("#zoom-"+$thumb.attr("id")))}),self.getFrames().length&&self.showPreview||self._resetUpload(),self._validateDefaultPreview()},_initSortable:function(){var settings,self=this,$el=self.$preview,selector="."+$h.SORT_CSS;window.KvSortable&&0!==$el.find(selector).length&&(settings={handle:".drag-handle-init",dataIdAttr:"data-preview-id",scroll:!1,draggable:selector,onSort:function(e){var key,oldIndex=e.oldIndex,newIndex=e.newIndex;self.initialPreview=$h.moveArray(self.initialPreview,oldIndex,newIndex),self.initialPreviewConfig=$h.moveArray(self.initialPreviewConfig,oldIndex,newIndex),self.previewCache.init();for(var i=0;i<self.initialPreviewConfig.length;i++)null!==self.initialPreviewConfig[i]&&(key=self.initialPreviewConfig[i].key,$(".kv-file-remove[data-key='"+key+"']").closest($h.FRAMES).attr("data-fileindex","init_"+i).attr("data-fileindex","init_"+i));self._raise("filesorted",{previewId:$(e.item).attr("id"),oldIndex:oldIndex,newIndex:newIndex,stack:self.initialPreviewConfig})}},$el.data("kvsortable")&&$el.kvsortable("destroy"),$.extend(!0,settings,self.fileActionSettings.dragSettings),$el.kvsortable(settings))},_setPreviewContent:function(content){var self=this;self.$preview.html(content),self._autoFitContent()},_initPreview:function(isInit){var out,self=this,cap=self.initialCaption||"";if(!self.previewCache.count())return self._clearPreview(),void(isInit?self._setCaption(cap):self._initCaption());out=self.previewCache.out(),cap=isInit&&self.initialCaption?self.initialCaption:out.caption,self._setPreviewContent(out.content),self._setInitThumbAttr(),self._setCaption(cap),self._initSortable(),$h.isEmpty(out.content)||self.$container.removeClass("file-input-new")},_getZoomButton:function(type){var self=this,label=self.previewZoomButtonIcons[type],css=self.previewZoomButtonClasses[type],params=' title="'+(self.previewZoomButtonTitles[type]||"")+'" '+("close"===type?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==type&&"borderless"!==type&&"toggleheader"!==type||(params+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+css+" btn-"+type+'"'+params+">"+label+"</button>"},_getModalContent:function(){var self=this;return self._getLayoutTemplate("modal").setTokens({rtl:self.rtl?" kv-rtl":"",zoomFrameClass:self.frameClass,heading:self.msgZoomModalHeading,prev:self._getZoomButton("prev"),next:self._getZoomButton("next"),toggleheader:self._getZoomButton("toggleheader"),fullscreen:self._getZoomButton("fullscreen"),borderless:self._getZoomButton("borderless"),close:self._getZoomButton("close")})},_listenModalEvent:function(event){var self=this,$modal=self.$modal,getParams=function(e){return{sourceEvent:e,previewId:$modal.data("previewId"),modal:$modal}};$modal.on(event+".bs.modal",function(e){var $btnFull=$modal.find(".btn-fullscreen"),$btnBord=$modal.find(".btn-borderless");self._raise("filezoom"+event,getParams(e)),"shown"===event&&($btnBord.removeClass("active").attr("aria-pressed","false"),$btnFull.removeClass("active").attr("aria-pressed","false"),$modal.hasClass("file-zoom-fullscreen")&&(self._maximizeZoomDialog(),$h.checkFullScreen()?$btnFull.addClass("active").attr("aria-pressed","true"):$btnBord.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var $dialog,self=this,modalMain=self._getLayoutTemplate("modalMain"),modalId="#"+$h.MODAL_ID;self.showPreview&&(self.$modal=$(modalId),self.$modal&&self.$modal.length||($dialog=$(document.createElement("div")).html(modalMain).insertAfter(self.$container),self.$modal=$(modalId).insertBefore($dialog),$dialog.remove()),$h.initModal(self.$modal),self.$modal.html(self._getModalContent()),$.each($h.MODAL_EVENTS,function(key,event){self._listenModalEvent(event)}))},_initZoomButtons:function(){var $first,$last,self=this,previewId=self.$modal.data("previewId")||"",thumbs=self.getFrames().toArray(),len=thumbs.length,$prev=self.$modal.find(".btn-prev"),$next=self.$modal.find(".btn-next");if(thumbs.length<2)return $prev.hide(),void $next.hide();$prev.show(),$next.show(),len&&($first=$(thumbs[0]),$last=$(thumbs[len-1]),$prev.removeAttr("disabled"),$next.removeAttr("disabled"),$first.length&&$first.attr("id")===previewId&&$prev.attr("disabled",!0),$last.length&&$last.attr("id")===previewId&&$next.attr("disabled",!0))},_maximizeZoomDialog:function(){var $modal=this.$modal,$head=$modal.find(".modal-header:visible"),$foot=$modal.find(".modal-footer:visible"),$body=$modal.find(".modal-body"),h=$(window).height();$modal.addClass("file-zoom-fullscreen"),$head&&$head.length&&(h-=$head.outerHeight(!0)),$foot&&$foot.length&&(h-=$foot.outerHeight(!0)),$body&&$body.length&&(h-=$body.outerHeight(!0)-$body.height()),$modal.find(".kv-zoom-body").height(h)},_resizeZoomDialog:function(fullScreen){var self=this,$modal=self.$modal,$btnFull=$modal.find(".btn-fullscreen"),$btnBord=$modal.find(".btn-borderless");if($modal.hasClass("file-zoom-fullscreen"))$h.toggleFullScreen(!1),fullScreen?$btnFull.hasClass("active")||($modal.removeClass("file-zoom-fullscreen"),self._resizeZoomDialog(!0),$btnBord.hasClass("active")&&$btnBord.removeClass("active").attr("aria-pressed","false")):$btnFull.hasClass("active")?$btnFull.removeClass("active").attr("aria-pressed","false"):($modal.removeClass("file-zoom-fullscreen"),self.$modal.find(".kv-zoom-body").css("height",self.zoomModalHeight));else{if(!fullScreen)return void self._maximizeZoomDialog();$h.toggleFullScreen(!0)}$modal.focus()},_setZoomContent:function($frame,animate){var $content,tmplt,body,title,$body,$dataEl,config,$tmp,self=this,pid=$frame.attr("id"),$modal=self.$modal,$prev=$modal.find(".btn-prev"),$next=$modal.find(".btn-next"),$btnFull=$modal.find(".btn-fullscreen"),$btnBord=$modal.find(".btn-borderless"),$btnTogh=$modal.find(".btn-toggleheader"),$zoomPreview=self.$preview.find("#zoom-"+pid);tmplt=$zoomPreview.attr("data-template")||"generic",body=($content=$zoomPreview.find(".kv-file-content")).length?$content.html():"",title=($frame.data("caption")||"")+" "+($frame.data("size")||""),$modal.find(".kv-zoom-title").html(title),$body=$modal.find(".kv-zoom-body"),$modal.removeClass("kv-single-content"),animate?($tmp=$body.addClass("file-thumb-loading").clone().insertAfter($body),$body.html(body).hide(),$tmp.fadeOut("fast",function(){$body.fadeIn("fast",function(){$body.removeClass("file-thumb-loading")}),$tmp.remove()})):$body.html(body),(config=self.previewZoomSettings[tmplt])&&($dataEl=$body.find(".kv-preview-data"),$h.addCss($dataEl,"file-zoom-detail"),$.each(config,function(key,value){$dataEl.css(key,value),($dataEl.attr("width")&&"width"===key||$dataEl.attr("height")&&"height"===key)&&$dataEl.removeAttr(key)})),$modal.data("previewId",pid);var $img=$body.find("img");$img.length&&$h.adjustOrientedImage($img,!0),self._handler($prev,"click",function(){self._zoomSlideShow("prev",pid)}),self._handler($next,"click",function(){self._zoomSlideShow("next",pid)}),self._handler($btnFull,"click",function(){self._resizeZoomDialog(!0)}),self._handler($btnBord,"click",function(){self._resizeZoomDialog(!1)}),self._handler($btnTogh,"click",function(){var ht,$header=$modal.find(".modal-header"),$floatBar=$modal.find(".modal-body .floating-buttons"),$actions=$header.find(".kv-zoom-actions"),resize=function(height){var $body=self.$modal.find(".kv-zoom-body"),h=self.zoomModalHeight;$modal.hasClass("file-zoom-fullscreen")&&(h=$body.outerHeight(!0),height||(h-=$header.outerHeight(!0))),$body.css("height",height?h+height:h)};$header.is(":visible")?(ht=$header.outerHeight(!0),$header.slideUp("slow",function(){$actions.find(".btn").appendTo($floatBar),resize(ht)})):($floatBar.find(".btn").appendTo($actions),$header.slideDown("slow",function(){resize()})),$modal.focus()}),self._handler($modal,"keydown",function(e){var key=e.which||e.keyCode;37!==key||$prev.attr("disabled")||self._zoomSlideShow("prev",pid),39!==key||$next.attr("disabled")||self._zoomSlideShow("next",pid)})},_zoomPreview:function($btn){var $frame,self=this,$modal=self.$modal;if(!$btn.length)throw"Cannot zoom to detailed preview!";$h.initModal($modal),$modal.html(self._getModalContent()),$frame=$btn.closest($h.FRAMES),self._setZoomContent($frame),$modal.modal("show"),self._initZoomButtons()},_zoomSlideShow:function(dir,previewId){var $targFrame,i,out,self=this,$btn=self.$modal.find(".kv-zoom-actions .btn-"+dir),thumbs=self.getFrames().toArray(),len=thumbs.length;if(!$btn.attr("disabled")){for(i=0;i<len;i++)if($(thumbs[i]).attr("id")===previewId){out="prev"===dir?i-1:i+1;break}out<0||out>=len||!thumbs[out]||(($targFrame=$(thumbs[out])).length&&self._setZoomContent($targFrame,!0),self._initZoomButtons(),self._raise("filezoom"+dir,{previewId:previewId,modal:self.$modal}))}},_initZoomButton:function(){var self=this;self.$preview.find(".kv-file-zoom").each(function(){var $el=$(this);self._handler($el,"click",function(){self._zoomPreview($el)})})},_clearObjects:function($el){$el.find("video audio").each(function(){this.pause(),$(this).remove()}),$el.find("img object div").each(function(){$(this).remove()})},_clearFileInput:function(){var $srcFrm,$tmpFrm,$tmpEl,self=this,$el=self.$element;self.fileInputCleared=!0,$h.isEmpty($el.val())||(self.isIE9||self.isIE10?($srcFrm=$el.closest("form"),$tmpFrm=$(document.createElement("form")),$tmpEl=$(document.createElement("div")),$el.before($tmpEl),$srcFrm.length?$srcFrm.after($tmpFrm):$tmpEl.after($tmpFrm),$tmpFrm.append($el).trigger("reset"),$tmpEl.before($el).remove(),$tmpFrm.remove()):$el.val(""))},_resetUpload:function(){var self=this;self.uploadCache={content:[],config:[],tags:[],append:!0},self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.uploadAsyncCount=0,self.loadedImages=[],self.totalImagesCount=0,self.$btnUpload.removeAttr("disabled"),self._setProgress(0),self.$progress.hide(),self._resetErrors(!1),self.ajaxAborted=!1,self.ajaxRequests=[],self._resetCanvas(),self.cacheInitialPreview={},self.overwriteInitial&&(self.initialPreview=[],self.initialPreviewConfig=[],self.initialPreviewThumbTags=[],self.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var self=this;self.canvas&&self.imageCanvasContext&&self.imageCanvasContext.clearRect(0,0,self.canvas.width,self.canvas.height)},_hasInitialPreview:function(){var self=this;return!self.overwriteInitial&&self.previewCache.count()},_resetPreview:function(){var out,cap,self=this;self.previewCache.count()?(out=self.previewCache.out(),self._setPreviewContent(out.content),self._setInitThumbAttr(),cap=self.initialCaption?self.initialCaption:out.caption,self._setCaption(cap)):(self._clearPreview(),self._initCaption()),self.showPreview&&(self._initZoom(),self._initSortable())},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var self=this;self.showPreview&&!$h.isEmpty(self.defaultPreviewContent)&&(self._setPreviewContent('<div class="file-default-preview">'+self.defaultPreviewContent+"</div>"),self.$container.removeClass("file-input-new"),self._initClickable())},_resetPreviewThumbs:function(isAjax){var out,self=this;if(isAjax)return self._clearPreview(),void self.clearStack();self._hasInitialPreview()?(out=self.previewCache.out(),self._setPreviewContent(out.content),self._setInitThumbAttr(),self._setCaption(out.caption),self._initPreviewActions()):self._clearPreview()},_getLayoutTemplate:function(t){var self=this,template=self.layoutTemplates[t];return $h.isEmpty(self.customLayoutTags)?template:$h.replaceTags(template,self.customLayoutTags)},_getPreviewTemplate:function(t){var self=this,template=self.previewTemplates[t];return $h.isEmpty(self.customPreviewTags)?template:$h.replaceTags(template,self.customPreviewTags)},_getOutData:function(jqXHR,responseData,filesData){var self=this;return jqXHR=jqXHR||{},responseData=responseData||{},filesData=filesData||self.filestack.slice(0)||{},{form:self.formdata,files:filesData,filenames:self.filenames,filescount:self.getFilesCount(),extra:self._getExtraData(),response:responseData,reader:self.reader,jqXHR:jqXHR}},_getMsgSelected:function(n){var self=this,strFiles=1===n?self.fileSingle:self.filePlural;return n>0?self.msgSelected.replace("{n}",n).replace("{files}",strFiles):self.msgNoFilesSelected},_getFrame:function(id){var self=this,$frame=$("#"+id);return $frame.length?$frame:(self._log('Invalid thumb frame with id: "'+id+'".'),null)},_getThumbs:function(css){return css=css||"",this.getFrames(":not(.file-preview-initial)"+css)},_getExtraData:function(previewId,index){var self=this,data=self.uploadExtraData;return"function"==typeof self.uploadExtraData&&(data=self.uploadExtraData(previewId,index)),data},_initXhr:function(xhrobj,previewId,fileCount){var self=this;return xhrobj.upload&&xhrobj.upload.addEventListener("progress",function(event){var pct=0,total=event.total,position=event.loaded||event.position;event.lengthComputable&&(pct=Math.floor(position/total*100)),previewId?self._setAsyncUploadStatus(previewId,pct,fileCount):self._setProgress(pct)},!1),xhrobj},_mergeAjaxCallback:function(funcName,srcFunc,type){var targFunc,self=this,settings=self.ajaxSettings,flag=self.mergeAjaxCallbacks;"delete"===type&&(settings=self.ajaxDeleteSettings,flag=self.mergeAjaxDeleteCallbacks),targFunc=settings[funcName],settings[funcName]=flag&&"function"==typeof targFunc?"before"===flag?function(){targFunc.apply(this,arguments),srcFunc.apply(this,arguments)}:function(){srcFunc.apply(this,arguments),targFunc.apply(this,arguments)}:srcFunc,"delete"===type?self.ajaxDeleteSettings=settings:self.ajaxSettings=settings},_ajaxSubmit:function(fnBefore,fnSuccess,fnComplete,fnError,previewId,index){var settings,self=this;self._raise("filepreajax",[previewId,index])&&(self._uploadExtra(previewId,index),self._mergeAjaxCallback("beforeSend",fnBefore),self._mergeAjaxCallback("success",fnSuccess),self._mergeAjaxCallback("complete",fnComplete),self._mergeAjaxCallback("error",fnError),settings=$.extend(!0,{},{xhr:function(){var xhrobj=$.ajaxSettings.xhr();return self._initXhr(xhrobj,previewId,self.getFileStack().length)},url:index&&self.uploadUrlThumb?self.uploadUrlThumb:self.uploadUrl,type:"POST",dataType:"json",data:self.formdata,cache:!1,processData:!1,contentType:!1},self.ajaxSettings),self.ajaxRequests.push($.ajax(settings)))},_mergeArray:function(prop,content){var self=this,arr1=$h.cleanArray(self[prop]),arr2=$h.cleanArray(content);self[prop]=arr1.concat(arr2)},_initUploadSuccess:function(out,$thumb,allFiles){var append,data,index,$div,$newCache,content,config,tags,i,self=this;self.showPreview&&"object"==typeof out&&!$.isEmptyObject(out)&&void 0!==out.initialPreview&&out.initialPreview.length>0&&(self.hasInitData=!0,content=out.initialPreview||[],config=out.initialPreviewConfig||[],tags=out.initialPreviewThumbTags||[],append=void 0===out.append||out.append,content.length>0&&!$h.isArray(content)&&(content=content.split(self.initialPreviewDelimiter)),self._mergeArray("initialPreview",content),self._mergeArray("initialPreviewConfig",config),self._mergeArray("initialPreviewThumbTags",tags),void 0!==$thumb?allFiles?(i=$thumb.attr("data-fileindex"),self.uploadCache.content[i]=content[0],self.uploadCache.config[i]=config[0]||[],self.uploadCache.tags[i]=tags[0]||[],self.uploadCache.append=append):(index=self.previewCache.add(content,config[0],tags[0],append),data=self.previewCache.get(index,!1),($newCache=($div=$(document.createElement("div")).html(data).hide().insertAfter($thumb)).find(".kv-zoom-cache"))&&$newCache.length&&$newCache.insertAfter($thumb),$thumb.fadeOut("slow",function(){var $newThumb=$div.find(".file-preview-frame");$newThumb&&$newThumb.length&&$newThumb.insertBefore($thumb).fadeIn("slow").css("display:inline-block"),self._initPreviewActions(),self._clearFileInput(),$h.cleanZoomCache(self.$preview.find("#zoom-"+$thumb.attr("id"))),$thumb.remove(),$div.remove(),self._initSortable()})):(self.previewCache.set(content,config,tags,append),self._initPreview(),self._initPreviewActions()))},_initSuccessThumbs:function(){var self=this;self.showPreview&&self._getThumbs($h.FRAMES+".file-preview-success").each(function(){var $thumb=$(this),$preview=self.$preview,$remove=$thumb.find(".kv-file-remove");$remove.removeAttr("disabled"),self._handler($remove,"click",function(){var id=$thumb.attr("id"),out=self._raise("filesuccessremove",[id,$thumb.attr("data-fileindex")]);$h.cleanMemory($thumb),!1!==out&&$thumb.fadeOut("slow",function(){$h.cleanZoomCache($preview.find("#zoom-"+id)),$thumb.remove(),self.getFrames().length||self.reset()})})})},_checkAsyncComplete:function(){var previewId,i,self=this;for(i=0;i<self.filestack.length;i++)if(self.filestack[i]&&(previewId=self.previewInitId+"-"+i,-1===$.inArray(previewId,self.uploadLog)))return!1;return self.uploadAsyncCount===self.uploadLog.length},_uploadExtra:function(previewId,index){var self=this,data=self._getExtraData(previewId,index);0!==data.length&&$.each(data,function(key,value){self.formdata.append(key,value)})},_uploadSingle:function(i,allFiles){var outData,$thumb,chkComplete,$btnUpload,$btnDelete,uploadFailed,fnBefore,fnSuccess,fnComplete,fnError,updateUploadLog,self=this,total=self.getFileStack().length,formdata=new FormData,previewId=self.previewInitId+"-"+i,hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData),$prog=$("#"+previewId).find(".file-thumb-progress"),params={id:previewId,index:i};self.formdata=formdata,self.showPreview&&($thumb=$("#"+previewId+":not(.file-preview-initial)"),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove"),$prog.show()),0===total||!hasPostData||$btnUpload&&$btnUpload.hasClass("disabled")||self._abort(params)||(updateUploadLog=function(i,previewId){uploadFailed||self.updateStack(i,void 0),self.uploadLog.push(previewId),self._checkAsyncComplete()&&(self.fileBatchCompleted=!0)},chkComplete=function(){var $initThumbs,i,j,u=self.uploadCache,len=0,data=self.cacheInitialPreview;self.fileBatchCompleted&&(data&&data.content&&(len=data.content.length),setTimeout(function(){var triggerReset=0===self.getFileStack(!0).length;if(self.showPreview){if(self.previewCache.set(u.content,u.config,u.tags,u.append),len){for(i=0;i<u.content.length;i++)j=i+len,data.content[j]=u.content[i],data.config.length&&(data.config[j]=u.config[i]),data.tags.length&&(data.tags[j]=u.tags[i]);self.initialPreview=$h.cleanArray(data.content),self.initialPreviewConfig=$h.cleanArray(data.config),self.initialPreviewThumbTags=$h.cleanArray(data.tags)}else self.initialPreview=u.content,self.initialPreviewConfig=u.config,self.initialPreviewThumbTags=u.tags;self.cacheInitialPreview={},self.hasInitData&&(self._initPreview(),self._initPreviewActions())}self.unlock(triggerReset),triggerReset&&self._clearFileInput(),$initThumbs=self.$preview.find(".file-preview-initial"),self.uploadAsync&&$initThumbs.length&&($h.addCss($initThumbs,$h.SORT_CSS),self._initSortable()),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()]),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self._setProgress(101)},100))},fnBefore=function(jqXHR){outData=self._getOutData(jqXHR),self.fileBatchCompleted=!1,self.showPreview&&($thumb.hasClass("file-preview-success")||(self._setThumbStatus($thumb,"Loading"),$h.addCss($thumb,"file-uploading")),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0)),allFiles||self.lock(),self._raise("filepreupload",[outData,previewId,i]),$.extend(!0,params,outData),self._abort(params)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var pid=self.showPreview&&$thumb.attr("id")?$thumb.attr("id"):previewId;outData=self._getOutData(jqXHR,data),$.extend(!0,params,outData),setTimeout(function(){$h.isEmpty(data)||$h.isEmpty(data.error)?(self.showPreview&&(self._setThumbStatus($thumb,"Success"),$btnUpload.hide(),self._initUploadSuccess(data,$thumb,allFiles),self._setProgress(101,$prog)),self._raise("fileuploaded",[outData,pid,i]),allFiles?updateUploadLog(i,pid):self.updateStack(i,void 0)):(uploadFailed=!0,self._showUploadError(data.error,params),self._setPreviewError($thumb,i,self.filestack[i],self.retryErrorUploads),self.retryErrorUploads||$btnUpload.hide(),allFiles&&updateUploadLog(i,pid),self._setProgress(101,$("#"+pid).find(".file-thumb-progress"),self.msgUploadError))},100)},fnComplete=function(){setTimeout(function(){self.showPreview&&($btnUpload.removeAttr("disabled"),$btnDelete.removeAttr("disabled"),$thumb.removeClass("file-uploading")),allFiles?chkComplete():(self.unlock(!1),self._clearFileInput()),self._initSuccessThumbs()},100)},fnError=function(jqXHR,textStatus,errorThrown){var op=self.ajaxOperations.uploadThumb,errMsg=self._parseError(op,jqXHR,errorThrown,allFiles&&self.filestack[i].name?self.filestack[i].name:null);uploadFailed=!0,setTimeout(function(){allFiles&&updateUploadLog(i,previewId),self.uploadStatus[previewId]=100,self._setPreviewError($thumb,i,self.filestack[i],self.retryErrorUploads),self.retryErrorUploads||$btnUpload.hide(),$.extend(!0,params,self._getOutData(jqXHR)),self._setProgress(101,$prog,self.msgAjaxProgressError.replace("{operation}",op)),self._setProgress(101,$("#"+previewId).find(".file-thumb-progress"),self.msgUploadError),self._showUploadError(errMsg,params)},100)},formdata.append(self.uploadFileAttr,self.filestack[i],self.filenames[i]),formdata.append("file_id",i),self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError,previewId,i))},_uploadBatch:function(){var fnBefore,fnSuccess,fnError,fnComplete,setAllUploaded,self=this,files=self.filestack,total=files.length,params={},hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData);self.formdata=new FormData,0!==total&&hasPostData&&!self._abort(params)&&(setAllUploaded=function(){$.each(files,function(key){self.updateStack(key,void 0)}),self._clearFileInput()},fnBefore=function(jqXHR){self.lock();var outData=self._getOutData(jqXHR);self.showPreview&&self._getThumbs().each(function(){var $thumb=$(this),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove");$thumb.hasClass("file-preview-success")||(self._setThumbStatus($thumb,"Loading"),$h.addCss($thumb,"file-uploading")),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0)}),self._raise("filebatchpreupload",[outData]),self._abort(outData)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var outData=self._getOutData(jqXHR,data),key=0,$thumbs=self._getThumbs(":not(.file-preview-success)"),keys=$h.isEmpty(data)||$h.isEmpty(data.errorkeys)?[]:data.errorkeys;$h.isEmpty(data)||$h.isEmpty(data.error)?(self._raise("filebatchuploadsuccess",[outData]),setAllUploaded(),self.showPreview?($thumbs.each(function(){var $thumb=$(this);self._setThumbStatus($thumb,"Success"),$thumb.removeClass("file-uploading"),$thumb.find(".kv-file-upload").hide().removeAttr("disabled")}),self._initUploadSuccess(data)):self.reset(),self._setProgress(101)):(self.showPreview&&($thumbs.each(function(){var $thumb=$(this),i=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),$thumb.find(".kv-file-upload").removeAttr("disabled"),$thumb.find(".kv-file-remove").removeAttr("disabled"),0===keys.length||-1!==$.inArray(key,keys)?(self._setPreviewError($thumb,i,self.filestack[i],self.retryErrorUploads),self.retryErrorUploads||($thumb.find(".kv-file-upload").hide(),self.updateStack(i,void 0))):($thumb.find(".kv-file-upload").hide(),self._setThumbStatus($thumb,"Success"),self.updateStack(i,void 0)),$thumb.hasClass("file-preview-error")&&!self.retryErrorUploads||key++}),self._initUploadSuccess(data)),self._showUploadError(data.error,outData,"filebatchuploaderror"),self._setProgress(101,self.$progress,self.msgUploadError))},fnComplete=function(){self.unlock(),self._initSuccessThumbs(),self._clearFileInput(),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()])},fnError=function(jqXHR,textStatus,errorThrown){var outData=self._getOutData(jqXHR),op=self.ajaxOperations.uploadBatch,errMsg=self._parseError(op,jqXHR,errorThrown);self._showUploadError(errMsg,outData,"filebatchuploaderror"),self.uploadFileCount=total-1,self.showPreview&&(self._getThumbs().each(function(){var $thumb=$(this),key=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[key]&&self._setPreviewError($thumb)}),self._getThumbs().removeClass("file-uploading"),self._getThumbs(" .kv-file-upload").removeAttr("disabled"),self._getThumbs(" .kv-file-delete").removeAttr("disabled"),self._setProgress(101,self.$progress,self.msgAjaxProgressError.replace("{operation}",op)))},$.each(files,function(key,data){$h.isEmpty(files[key])||self.formdata.append(self.uploadFileAttr,data,self.filenames[key])}),self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},_uploadExtraOnly:function(){var fnBefore,fnSuccess,fnComplete,fnError,self=this,params={};self.formdata=new FormData,self._abort(params)||(fnBefore=function(jqXHR){self.lock();var outData=self._getOutData(jqXHR);self._raise("filebatchpreupload",[outData]),self._setProgress(50),params.data=outData,params.xhr=jqXHR,self._abort(params)&&(jqXHR.abort(),self._setProgressCancelled())},fnSuccess=function(data,textStatus,jqXHR){var outData=self._getOutData(jqXHR,data);$h.isEmpty(data)||$h.isEmpty(data.error)?(self._raise("filebatchuploadsuccess",[outData]),self._clearFileInput(),self._initUploadSuccess(data),self._setProgress(101)):self._showUploadError(data.error,outData,"filebatchuploaderror")},fnComplete=function(){self.unlock(),self._clearFileInput(),self._raise("filebatchuploadcomplete",[self.filestack,self._getExtraData()])},fnError=function(jqXHR,textStatus,errorThrown){var outData=self._getOutData(jqXHR),op=self.ajaxOperations.uploadExtra,errMsg=self._parseError(op,jqXHR,errorThrown);params.data=outData,self._showUploadError(errMsg,outData,"filebatchuploaderror"),self._setProgress(101,self.$progress,self.msgAjaxProgressError.replace("{operation}",op))},self._ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},_deleteFileIndex:function($frame){var self=this,ind=$frame.attr("data-fileindex");"init_"===ind.substring(0,5)&&(ind=parseInt(ind.replace("init_","")),self.initialPreview=$h.spliceArray(self.initialPreview,ind),self.initialPreviewConfig=$h.spliceArray(self.initialPreviewConfig,ind),self.initialPreviewThumbTags=$h.spliceArray(self.initialPreviewThumbTags,ind),self.getFrames().each(function(){var $nFrame=$(this),nInd=$nFrame.attr("data-fileindex");"init_"===nInd.substring(0,5)&&(nInd=parseInt(nInd.replace("init_","")))>ind&&(nInd--,$nFrame.attr("data-fileindex","init_"+nInd))}),self.uploadAsync&&(self.cacheInitialPreview=self.getPreview()))},_initFileActions:function(){var self=this,$preview=self.$preview;self.showPreview&&(self._initZoomButton(),self.getFrames(" .kv-file-remove").each(function(){var hasError,n,cap,status,$el=$(this),$frame=$el.closest($h.FRAMES),id=$frame.attr("id"),ind=$frame.attr("data-fileindex");self._handler($el,"click",function(){if(!1===(status=self._raise("filepreremove",[id,ind]))||!self._validateMinCount())return!1;hasError=$frame.hasClass("file-preview-error"),$h.cleanMemory($frame),$frame.fadeOut("slow",function(){$h.cleanZoomCache($preview.find("#zoom-"+id)),self.updateStack(ind,void 0),self._clearObjects($frame),$frame.remove(),id&&hasError&&self.$errorContainer.find('li[data-file-id="'+id+'"]').fadeOut("fast",function(){$(this).remove(),self._errorsExist()||self._resetErrors()}),self._clearFileInput();var filestack=self.getFileStack(!0),chk=self.previewCache.count(),len=filestack.length,hasThumb=self.showPreview&&self.getFrames().length;0!==len||0!==chk||hasThumb?(cap=(n=chk+len)>1?self._getMsgSelected(n):filestack[0]?self._getFileNames()[0]:"",self._setCaption(cap)):self.reset(),self._raise("fileremoved",[id,ind])})})}),self.getFrames(" .kv-file-upload").each(function(){var $el=$(this);self._handler($el,"click",function(){var $frame=$el.closest($h.FRAMES),ind=$frame.attr("data-fileindex");self.$progress.hide(),$frame.hasClass("file-preview-error")&&!self.retryErrorUploads||self._uploadSingle(ind,!1)})}))},_initPreviewActions:function(){var self=this,$preview=self.$preview,deleteExtraData=self.deleteExtraData||{},btnRemove=$h.FRAMES+" .kv-file-remove",settings=self.fileActionSettings,origClass=settings.removeClass,errClass=settings.removeErrorClass,resetProgress=function(){var hasFiles=self.isUploadable?self.previewCache.count():self.$element.get(0).files.length;$preview.find($h.FRAMES).length||hasFiles||(self._setCaption(""),self.reset(),self.initialCaption="")};self._initZoomButton(),$preview.find(btnRemove).each(function(){var fnBefore,fnSuccess,fnError,$el=$(this),vUrl=$el.data("url")||self.deleteUrl,vKey=$el.data("key");$el.closest(".file-preview-frame");if(!$h.isEmpty(vUrl)&&void 0!==vKey){var settings,params,config,extraData,$frame=$el.closest($h.FRAMES),cache=self.previewCache.data,index=$frame.attr("data-fileindex");index=parseInt(index.replace("init_","")),config=$h.isEmpty(cache.config)&&$h.isEmpty(cache.config[index])?null:cache.config[index],"function"==typeof(extraData=$h.isEmpty(config)||$h.isEmpty(config.extra)?deleteExtraData:config.extra)&&(extraData=extraData()),params={id:$el.attr("id"),key:vKey,extra:extraData},fnBefore=function(jqXHR){self.ajaxAborted=!1,self._raise("filepredelete",[vKey,jqXHR,extraData]),$el.removeClass(errClass),self._abort()?jqXHR.abort():($h.addCss($frame,"file-uploading"),$h.addCss($el,"disabled "+origClass))},fnSuccess=function(data,textStatus,jqXHR){var n,cap;if(!$h.isEmpty(data)&&!$h.isEmpty(data.error))return params.jqXHR=jqXHR,params.response=data,self._showError(data.error,params,"filedeleteerror"),$frame.removeClass("file-uploading"),$el.removeClass("disabled "+origClass).addClass(errClass),void resetProgress();$frame.removeClass("file-uploading").addClass("file-deleted"),$frame.fadeOut("slow",function(){index=parseInt($frame.attr("data-fileindex").replace("init_","")),self.previewCache.unset(index),n=self.previewCache.count(),cap=n>0?self._getMsgSelected(n):"",self._deleteFileIndex($frame),self._setCaption(cap),self._raise("filedeleted",[vKey,jqXHR,extraData]),$h.cleanZoomCache($preview.find("#zoom-"+$frame.attr("id"))),self._clearObjects($frame),$frame.remove(),resetProgress()})},fnError=function(jqXHR,textStatus,errorThrown){var op=self.ajaxOperations.deleteThumb,errMsg=self._parseError(op,jqXHR,errorThrown);params.jqXHR=jqXHR,params.response={},self._showError(errMsg,params,"filedeleteerror"),$frame.removeClass("file-uploading"),$el.removeClass("disabled "+origClass).addClass(errClass),resetProgress()},self._mergeAjaxCallback("beforeSend",fnBefore,"delete"),self._mergeAjaxCallback("success",fnSuccess,"delete"),self._mergeAjaxCallback("error",fnError,"delete"),settings=$.extend(!0,{},{url:vUrl,type:"POST",dataType:"json",data:$.extend(!0,{},{key:vKey},extraData)},self.ajaxDeleteSettings),self._handler($el,"click",function(){if(!self._validateMinCount())return!1;self.ajaxAborted=!1,self._raise("filebeforedelete",[vKey,extraData]),self.ajaxAborted instanceof Promise?self.ajaxAborted.then(function(result){result||$.ajax(settings)}):self.ajaxAborted||$.ajax(settings)})}})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(bytes){var i,sizes,out,self=this,size=parseFloat(bytes),func=self.fileSizeGetter;return $.isNumeric(bytes)&&$.isNumeric(size)?("function"==typeof func?out=func(size):0===size?out="0.00 B":(i=Math.floor(Math.log(size)/Math.log(1024)),sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],out=1*(size/Math.pow(1024,i)).toFixed(2)+" "+sizes[i]),self._getLayoutTemplate("size").replace("{sizeText}",out)):""},_generatePreviewTemplate:function(cat,data,fname,ftype,previewId,isError,size,frameClass,foot,ind,templ){var getContent,self=this,caption=self.slug(fname),zoomContent="",styleAttribs="",config=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<400?self.previewSettingsSmall[cat]||self.defaults.previewSettingsSmall[cat]:self.previewSettings[cat]||self.defaults.previewSettings[cat],footer=foot||self._renderFileFooter(caption,size,"auto",isError),hasIconSetting=self._getPreviewIcon(fname),typeCss="type-default",forcePrevIcon=hasIconSetting&&self.preferIconicPreview,forceZoomIcon=hasIconSetting&&self.preferIconicZoomPreview;return config&&$.each(config,function(key,val){styleAttribs+=key+":"+val+";"}),getContent=function(c,d,zoom,frameCss){var id=zoom?"zoom-"+previewId:previewId,tmplt=self._getPreviewTemplate(c),css=(frameClass||"")+" "+frameCss;return self.frameClass&&(css=self.frameClass+" "+css),zoom&&(css=css.replace(" "+$h.SORT_CSS,"")),tmplt=self._parseFilePreviewIcon(tmplt,fname),"text"===c&&(d=$h.htmlEncode(d)),"object"!==cat||ftype||$.each(self.defaults.fileTypeSettings,function(key,func){"object"!==key&&"other"!==key&&func(fname,ftype)&&(typeCss="type-"+key)}),tmplt.setTokens({previewId:id,caption:caption,frameClass:css,type:ftype,fileindex:ind,typeCss:typeCss,footer:footer,data:d,template:templ||cat,style:styleAttribs?'style="'+styleAttribs+'"':""})},ind=ind||previewId.slice(previewId.lastIndexOf("-")+1),self.fileActionSettings.showZoom&&(zoomContent=getContent(forceZoomIcon?"other":cat,data,!0,"kv-zoom-thumb")),zoomContent="\n"+self._getLayoutTemplate("zoomCache").replace("{zoomContent}",zoomContent),getContent(forcePrevIcon?"other":cat,data,!1,"kv-preview-thumb")+zoomContent},_previewDefault:function(file,previewId,isDisabled){var self=this,$preview=self.$preview;if(self.showPreview){var content,fname=file?file.name:"",ftype=file?file.type:"",size=file.size||0,caption=self.slug(fname),isError=!0===isDisabled&&!self.isUploadable,data=$h.objUrl.createObjectURL(file);self._clearDefaultPreview(),content=self._generatePreviewTemplate("other",data,fname,ftype,previewId,isError,size),$preview.append("\n"+content),self._setThumbAttr(previewId,caption,size),!0===isDisabled&&self.isUploadable&&self._setThumbStatus($("#"+previewId),"Error")}},_previewFile:function(i,file,theFile,previewId,data){if(this.showPreview){var content,self=this,cat=self._parseFileType(file),fname=file?file.name:"",caption=self.slug(fname),types=self.allowedPreviewTypes,mimes=self.allowedPreviewMimeTypes,$preview=self.$preview,chkTypes=types&&types.indexOf(cat)>=0,fsize=file.size||0,ftype=file.type,iData="text"===cat||"html"===cat||"image"===cat?theFile.target.result:data,chkMimes=mimes&&-1!==mimes.indexOf(ftype);if("html"===cat&&self.purifyHtml&&window.DOMPurify&&(iData=window.DOMPurify.sanitize(iData)),chkTypes||chkMimes){content=self._generatePreviewTemplate(cat,iData,fname,ftype,previewId,!1,fsize),self._clearDefaultPreview(),$preview.append("\n"+content);var $img=$preview.find("#"+previewId+" img");$img.length&&self.autoOrientImage?$h.validateOrientation(file,function(value){if(value){var $zoomImg=$preview.find("#zoom-"+previewId+" img"),css="rotate-"+value;value>4&&(css+=$img.width()>$img.height()?" is-portrait-gt4":" is-landscape-gt4"),$h.addCss($img,css),$h.addCss($zoomImg,css),self._raise("fileimageoriented",{$img:$img,file:file}),self._validateImage(previewId,caption,ftype,fsize,iData),$h.adjustOrientedImage($img)}else self._validateImage(previewId,caption,ftype,fsize,iData)}):self._validateImage(previewId,caption,ftype,fsize,iData)}else self._previewDefault(file,previewId);self._setThumbAttr(previewId,caption,fsize),self._initSortable()}},_setThumbAttr:function(id,caption,size){var self=this,$frame=$("#"+id);$frame.length&&(size=size&&size>0?self._getSize(size):"",$frame.data({caption:caption,size:size}))},_setInitThumbAttr:function(){var config,caption,size,previewId,self=this,data=self.previewCache.data,len=self.previewCache.count();if(0!==len)for(var i=0;i<len;i++)config=data.config[i],previewId=self.previewInitId+"-init_"+i,caption=$h.ifSet("caption",config,$h.ifSet("filename",config)),size=$h.ifSet("size",config),self._setThumbAttr(previewId,caption,size)},_slugDefault:function(text){return $h.isEmpty(text)?"":String(text).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(files){this.reader=new FileReader;var readFile,self=this,$el=self.$element,$preview=self.$preview,reader=self.reader,$container=self.$previewContainer,$status=self.$previewStatus,msgLoading=self.msgLoading,msgProgress=self.msgProgress,previewInitId=self.previewInitId,numFiles=files.length,settings=self.fileTypeSettings,ctr=self.filestack.length,fileTypes=self.allowedFileTypes,typLen=fileTypes?fileTypes.length:0,fileExt=self.allowedFileExtensions,strExt=$h.isEmpty(fileExt)?"":fileExt.join(", "),maxPreviewSize=self.maxFilePreviewSize&&parseFloat(self.maxFilePreviewSize),canPreview=$preview.length&&(!maxPreviewSize||isNaN(maxPreviewSize)),throwError=function(msg,file,previewId,index){var $thumb,p1=$.extend(!0,{},self._getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self._previewDefault(file,previewId,!0),self.isUploadable&&(self.addToStack(void 0),setTimeout(function(){readFile(index+1)},100)),self._initFileActions(),($thumb=$("#"+previewId)).find(".kv-file-upload").hide(),self.removeFromPreviewOnError&&$thumb.remove(),self.isUploadable?self._showUploadError(msg,p1):self._showError(msg,p2)};self.loadedImages=[],self.totalImagesCount=0,$.each(files,function(key,file){var func=self.fileTypeSettings.image;func&&func(file.type)&&self.totalImagesCount++}),(readFile=function(i){if($h.isEmpty($el.attr("multiple"))&&(numFiles=1),i>=numFiles)return self.isUploadable&&self.filestack.length>0?self._raise("filebatchselected",[self.getFileStack()]):self._raise("filebatchselected",[files]),$container.removeClass("file-thumb-loading"),void $status.html("");var isText,isImage,fSizeKB,j,msg,typ,chk,typ1,typ2,func,previewId=previewInitId+"-"+(ctr+i),file=files[i],caption=file.name?self.slug(file.name):"",fileSize=(file.size||0)/1e3,fileExtExpr="",previewData=$h.objUrl.createObjectURL(file),fileCount=0,strTypes="";if(typLen>0)for(j=0;j<typLen;j++)typ1=fileTypes[j],typ2=self.msgFileTypes[typ1]||typ1,strTypes+=0===j?typ2:", "+typ2;if(!1!==caption){if(0===caption.length)return msg=self.msgInvalidFileName.replace("{name}",$h.htmlEncode(file.name)),void(self.isError=throwError(msg,file,previewId,i));if($h.isEmpty(fileExt)||(fileExtExpr=new RegExp("\\.("+fileExt.join("|")+")$","i")),fSizeKB=fileSize.toFixed(2),self.maxFileSize>0&&fileSize>self.maxFileSize)return msg=self.msgSizeTooLarge.setTokens({name:caption,size:fSizeKB,maxSize:self.maxFileSize}),void(self.isError=throwError(msg,file,previewId,i));if(null!==self.minFileSize&&fileSize<=$h.getNum(self.minFileSize))return msg=self.msgSizeTooSmall.setTokens({name:caption,size:fSizeKB,minSize:self.minFileSize}),void(self.isError=throwError(msg,file,previewId,i));if(!$h.isEmpty(fileTypes)&&$h.isArray(fileTypes)){for(j=0;j<fileTypes.length;j+=1)typ=fileTypes[j],fileCount+=(func=settings[typ])&&"function"==typeof func&&func(file.type,file.name)?1:0;if(0===fileCount)return msg=self.msgInvalidFileType.setTokens({name:caption,types:strTypes}),void(self.isError=throwError(msg,file,previewId,i))}if(0===fileCount&&!$h.isEmpty(fileExt)&&$h.isArray(fileExt)&&!$h.isEmpty(fileExtExpr)&&(chk=$h.compare(caption,fileExtExpr),0===(fileCount+=$h.isEmpty(chk)?0:chk.length)))return msg=self.msgInvalidFileExtension.setTokens({name:caption,extensions:strExt}),void(self.isError=throwError(msg,file,previewId,i));if(!self.showPreview)return self.isUploadable&&self.addToStack(file),setTimeout(function(){readFile(i+1),self._updateFileDetails(numFiles)},100),void self._raise("fileloaded",[file,previewId,i,reader]);if(!canPreview&&fileSize>maxPreviewSize)return self.addToStack(file),$container.addClass("file-thumb-loading"),self._previewDefault(file,previewId),self._initFileActions(),self._updateFileDetails(numFiles),void readFile(i+1);$preview.length&&void 0!==FileReader?($status.html(msgLoading.replace("{index}",i+1).replace("{files}",numFiles)),$container.addClass("file-thumb-loading"),reader.onerror=function(evt){self._errorHandler(evt,caption)},reader.onload=function(theFile){self._previewFile(i,file,theFile,previewId,previewData),self._initFileActions()},reader.onloadend=function(){msg=msgProgress.setTokens({index:i+1,files:numFiles,percent:50,name:caption}),setTimeout(function(){$status.html(msg),self._updateFileDetails(numFiles),readFile(i+1)},100),self._raise("fileloaded",[file,previewId,i,reader])},reader.onprogress=function(data){if(data.lengthComputable){var fact=data.loaded/data.total*100,progress=Math.ceil(fact);msg=msgProgress.setTokens({index:i+1,files:numFiles,percent:progress,name:caption}),setTimeout(function(){$status.html(msg)},100)}},isText=settings.text,isImage=settings.image,isText(file.type,caption)?reader.readAsText(file,self.textEncoding):isImage(file.type,caption)?reader.readAsDataURL(file):reader.readAsArrayBuffer(file)):(self._previewDefault(file,previewId),setTimeout(function(){readFile(i+1),self._updateFileDetails(numFiles)},100),self._raise("fileloaded",[file,previewId,i,reader])),self.addToStack(file)}else readFile(i+1)})(0),self._updateFileDetails(numFiles,!1)},_updateFileDetails:function(numFiles){var self=this,$el=self.$element,fileStack=self.getFileStack(),name=$h.isIE(9)&&$h.findFileName($el.val())||$el[0].files[0]&&$el[0].files[0].name||fileStack.length&&fileStack[0].name||"",label=self.slug(name),n=self.isUploadable?fileStack.length:numFiles,nFiles=self.previewCache.count()+n,log=n>1?self._getMsgSelected(nFiles):label;self.isError?(self.$previewContainer.removeClass("file-thumb-loading"),self.$previewStatus.html(""),self.$captionContainer.find(".kv-caption-icon").hide()):self._showFileIcon(),self._setCaption(log,self.isError),self.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&self._raise("fileselect",[numFiles,label]),self.previewCache.count()&&self._initPreviewActions()},_setThumbStatus:function($thumb,status){var self=this;if(self.showPreview){var icon="indicator"+status,msg=icon+"Title",css="file-preview-"+status.toLowerCase(),$indicator=$thumb.find(".file-upload-indicator"),config=self.fileActionSettings;$thumb.removeClass("file-preview-success file-preview-error file-preview-loading"),"Success"===status&&$thumb.find(".file-drag-handle").remove(),$indicator.html(config[icon]),$indicator.attr("title",config[msg]),$thumb.addClass(css),"Error"!==status||self.retryErrorUploads||$thumb.find(".kv-file-upload").attr("disabled",!0)}},_setProgressCancelled:function(){var self=this;self._setProgress(101,self.$progress,self.msgCancelled)},_setProgress:function(p,$el,error){var out,self=this,pct=Math.min(p,100),pctLimit=self.progressUploadThreshold,t=p<=100?self.progressTemplate:self.progressCompleteTemplate,template=pct<100?self.progressTemplate:error?self.progressErrorTemplate:t;$el=$el||self.$progress,$h.isEmpty(template)||(out=pctLimit&&pct>pctLimit&&p<=100?template.setTokens({percent:pctLimit,status:self.msgUploadThreshold}):template.setTokens({percent:pct,status:p>100?self.msgUploadEnd:pct+"%"}),$el.html(out),error&&$el.find('[role="progressbar"]').html(error))},_setFileDropZoneTitle:function(){var strFiles,self=this,$zone=self.$container.find(".file-drop-zone"),title=self.dropZoneTitle;self.isClickable&&(strFiles=$h.isEmpty(self.$element.attr("multiple"))?self.fileSingle:self.filePlural,title+=self.dropZoneClickTitle.replace("{files}",strFiles)),$zone.find("."+self.dropZoneTitleClass).remove(),self.isUploadable&&self.showPreview&&0!==$zone.length&&!(self.getFileStack().length>0)&&self.dropZoneEnabled&&(0===$zone.find($h.FRAMES).length&&$h.isEmpty(self.defaultPreviewContent)&&$zone.prepend('<div class="'+self.dropZoneTitleClass+'">'+title+"</div>"),self.$container.removeClass("file-input-new"),$h.addCss(self.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(previewId,pct,total){var self=this,sum=0;self._setProgress(pct,$("#"+previewId).find(".file-thumb-progress")),self.uploadStatus[previewId]=pct,$.each(self.uploadStatus,function(key,value){sum+=value}),self._setProgress(Math.floor(sum/total))},_validateMinCount:function(){var self=this,len=self.isUploadable?self.getFileStack().length:self.$element.get(0).files.length;return!(self.validateInitialCount&&self.minFileCount>0&&self._getFileCount(len-1)<self.minFileCount)||(self._noFilesError({}),!1)},_getFileCount:function(fileCount){var self=this;return self.validateInitialCount&&!self.overwriteInitial&&(fileCount+=self.previewCache.count()),fileCount},_getFileId:function(file){var relativePath,custom=this.generateFileId;return"function"==typeof custom?custom(file,event):file&&(relativePath=String(file.webkitRelativePath||file.fileName||file.name||null))?file.size+"-"+relativePath.replace(/[^0-9a-zA-Z_-]/gim,""):null},_getFileName:function(file){return file&&file.name?this.slug(file.name):void 0},_getFileIds:function(skipNull){return this.fileids.filter(function(n){return skipNull?void 0!==n:void 0!==n&&null!==n})},_getFileNames:function(skipNull){return this.filenames.filter(function(n){return skipNull?void 0!==n:void 0!==n&&null!==n})},_setPreviewError:function($thumb,i,val,repeat){var self=this;void 0!==i&&self.updateStack(i,val),!self.removeFromPreviewOnError||repeat?(self._setThumbStatus($thumb,"Error"),self._refreshUploadButton($thumb,repeat)):$thumb.remove()},_refreshUploadButton:function($thumb,repeat){var self=this,$btn=$thumb.find(".kv-file-upload"),cfg=self.fileActionSettings,icon=cfg.uploadIcon,title=cfg.uploadTitle;$btn.length&&(repeat&&(icon=cfg.uploadRetryIcon,title=cfg.uploadRetryTitle),$btn.attr("title",title).html(icon))},_checkDimensions:function(i,chk,$img,$thumb,fname,type,params){var msg,dim,$imgEl,self=this,limit=self[("Small"===chk?"min":"max")+"Image"+type];!$h.isEmpty(limit)&&$img.length&&($imgEl=$img[0],dim="Width"===type?$imgEl.naturalWidth||$imgEl.width:$imgEl.naturalHeight||$imgEl.height,("Small"===chk?dim>=limit:dim<=limit)||(msg=self["msgImage"+type+chk].setTokens({name:fname,size:limit}),self._showUploadError(msg,params),self._setPreviewError($thumb,i,null)))},_validateImage:function(previewId,fname,ftype,fsize,iData){var params,w1,w2,exifObject,self=this,$preview=self.$preview,$thumb=$preview.find("#"+previewId),i=$thumb.attr("data-fileindex"),$img=$thumb.find("img");fname=fname||"Untitled",$img.one("load",function(){w1=$thumb.width(),w2=$preview.width(),w1>w2&&$img.css("width","100%"),params={ind:i,id:previewId},self._checkDimensions(i,"Small",$img,$thumb,fname,"Width",params),self._checkDimensions(i,"Small",$img,$thumb,fname,"Height",params),self.resizeImage||(self._checkDimensions(i,"Large",$img,$thumb,fname,"Width",params),self._checkDimensions(i,"Large",$img,$thumb,fname,"Height",params)),self._raise("fileimageloaded",[previewId]),exifObject=window.piexif?window.piexif.load(iData):null,self.loadedImages.push({ind:i,img:$img,thumb:$thumb,pid:previewId,typ:ftype,siz:fsize,validated:!1,imgData:iData,exifObj:exifObject}),$thumb.data("exif",exifObject),self._validateAllImages()}).one("error",function(){self._raise("fileimageloaderror",[previewId])}).each(function(){this.complete?$(this).trigger("load"):this.error&&$(this).trigger("error")})},_validateAllImages:function(){var i,config,fsize,self=this,counter={val:0},numImgs=self.loadedImages.length,minSize=self.resizeIfSizeMoreThan;if(numImgs===self.totalImagesCount&&(self._raise("fileimagesloaded"),self.resizeImage))for(i=0;i<self.loadedImages.length;i++)(config=self.loadedImages[i]).validated||((fsize=config.siz)&&fsize>1e3*minSize&&self._getResizedImage(config,counter,numImgs),self.loadedImages[i].validated=!0)},_getResizedImage:function(config,counter,numImgs){var blob,chkWidth,chkHeight,dataURI,throwError,msg,exifStr,self=this,img=$(config.img)[0],width=img.naturalWidth,height=img.naturalHeight,ratio=1,maxWidth=self.maxImageWidth||width,maxHeight=self.maxImageHeight||height,isValidImage=!(!width||!height),canvas=self.imageCanvas,context=self.imageCanvasContext,type=config.typ,pid=config.pid,ind=config.ind,$thumb=config.thumb,exifObj=config.exifObj;if(throwError=function(msg,params,ev){self.isUploadable?self._showUploadError(msg,params,ev):self._showError(msg,params,ev),self._setPreviewError($thumb,ind)},self.filestack[ind]&&isValidImage&&!(width<=maxWidth&&height<=maxHeight)||(isValidImage&&self.filestack[ind]&&self._raise("fileimageresized",[pid,ind]),counter.val++,counter.val===numImgs&&self._raise("fileimagesresized"),isValidImage)){type=type||self.resizeDefaultImageType,chkWidth=width>maxWidth,chkHeight=height>maxHeight,ratio="width"===self.resizePreference?chkWidth?maxWidth/width:chkHeight?maxHeight/height:1:chkHeight?maxHeight/height:chkWidth?maxWidth/width:1,self._resetCanvas(),width*=ratio,height*=ratio,canvas.width=width,canvas.height=height;try{context.drawImage(img,0,0,width,height),dataURI=canvas.toDataURL(type,self.resizeQuality),exifObj&&(exifStr=window.piexif.dump(exifObj),dataURI=window.piexif.insert(exifStr,dataURI)),blob=$h.dataURI2Blob(dataURI),self.filestack[ind]=blob,self._raise("fileimageresized",[pid,ind]),counter.val++,counter.val===numImgs&&self._raise("fileimagesresized",[void 0,void 0]),blob instanceof Blob||throwError(self.msgImageResizeError,{id:pid,index:ind},"fileimageresizeerror")}catch(err){counter.val++,counter.val===numImgs&&self._raise("fileimagesresized",[void 0,void 0]),msg=self.msgImageResizeException.replace("{errors}",err.message),throwError(msg,{id:pid,index:ind},"fileimageresizeexception")}}else throwError(self.msgImageResizeError,{id:pid,index:ind},"fileimageresizeerror")},_initBrowse:function($container){var self=this;self.showBrowse?(self.$btnFile=$container.find(".btn-file"),self.$btnFile.append(self.$element)):self.$element.hide()},_initCaption:function(){var self=this,cap=self.initialCaption||"";return self.overwriteInitial||$h.isEmpty(cap)?(self.$caption.html(""),!1):(self._setCaption(cap),!0)},_setCaption:function(content,isError){var title,out,n,cap,self=this,stack=self.getFileStack();if(self.$caption.length){if(isError)title=$("<div>"+self.msgValidationError+"</div>").text(),cap=(n=stack.length)?1===n&&stack[0]?self._getFileNames()[0]:self._getMsgSelected(n):self._getMsgSelected(self.msgNo),out='<span class="'+self.msgValidationErrorClass+'">'+self.msgValidationErrorIcon+($h.isEmpty(content)?cap:content)+"</span>";else{if($h.isEmpty(content))return;title=$("<div>"+content+"</div>").text(),out=self._getLayoutTemplate("fileIcon")+title}self.$caption.html(out),self.$caption.attr("title",title),self.$captionContainer.find(".file-caption-ellipsis").attr("title",title)}},_createContainer:function(){var self=this,attribs={class:"file-input file-input-new"+(self.rtl?" kv-rtl":"")},$container=$(document.createElement("div")).attr(attribs).html(self._renderMain());return self.$element.before($container),self._initBrowse($container),self.theme&&$container.addClass("theme-"+self.theme),$container},_refreshContainer:function(){var self=this,$container=self.$container;$container.before(self.$element),$container.html(self._renderMain()),self._initBrowse($container)},_renderMain:function(){var self=this,dropCss=self.isUploadable&&self.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",close=self.showClose?self._getLayoutTemplate("close"):"",preview=self.showPreview?self._getLayoutTemplate("preview").setTokens({class:self.previewClass,dropClass:dropCss}):"",css=self.isDisabled?self.captionClass+" file-caption-disabled":self.captionClass,caption=self.captionTemplate.setTokens({class:css+" kv-fileinput-caption"});return self.mainTemplate.setTokens({class:self.mainClass+(!self.showBrowse&&self.showCaption?" no-browse":""),preview:preview,close:close,caption:caption,upload:self._renderButton("upload"),remove:self._renderButton("remove"),cancel:self._renderButton("cancel"),browse:self._renderButton("browse")})},_renderButton:function(type){var self=this,tmplt=self._getLayoutTemplate("btnDefault"),css=self[type+"Class"],title=self[type+"Title"],icon=self[type+"Icon"],label=self[type+"Label"],status=self.isDisabled?" disabled":"",btnType="button";switch(type){case"remove":if(!self.showRemove)return"";break;case"cancel":if(!self.showCancel)return"";css+=" kv-hidden";break;case"upload":if(!self.showUpload)return"";self.isUploadable&&!self.isDisabled?tmplt=self._getLayoutTemplate("btnLink").replace("{href}",self.uploadUrl):btnType="submit";break;case"browse":if(!self.showBrowse)return"";tmplt=self._getLayoutTemplate("btnBrowse");break;default:return""}return css+="browse"===type?" btn-file":" fileinput-"+type+" fileinput-"+type+"-button",$h.isEmpty(label)||(label=' <span class="'+self.buttonLabelClass+'">'+label+"</span>"),tmplt.setTokens({type:btnType,css:css,title:title,status:status,icon:icon,label:label})},_renderThumbProgress:function(){var self=this;return'<div class="file-thumb-progress kv-hidden">'+self.progressTemplate.setTokens({percent:"0",status:self.msgUploadBegin})+"</div>"},_renderFileFooter:function(caption,size,width,isError){var out,self=this,config=self.fileActionSettings,rem=config.showRemove,drg=config.showDrag,upl=config.showUpload,zoom=config.showZoom,template=self._getLayoutTemplate("footer"),tInd=self._getLayoutTemplate("indicator"),ind=isError?config.indicatorError:config.indicatorNew,title=isError?config.indicatorErrorTitle:config.indicatorNewTitle,indicator=tInd.setTokens({indicator:ind,indicatorTitle:title});return size=self._getSize(size),out=self.isUploadable?template.setTokens({actions:self._renderFileActions(upl,!1,rem,zoom,drg,!1,!1,!1),caption:caption,size:size,width:width,progress:self._renderThumbProgress(),indicator:indicator}):template.setTokens({actions:self._renderFileActions(!1,!1,!1,zoom,drg,!1,!1,!1),caption:caption,size:size,width:width,progress:"",indicator:indicator}),out=$h.replaceTags(out,self.previewThumbTags)},_renderFileActions:function(showUpl,showDwn,showDel,showZoom,showDrag,disabled,url,key,isInit,dUrl,dFile){if(!(showUpl||showDwn||showDel||showZoom||showDrag))return"";var css,self=this,vUrl=!1===url?"":' data-url="'+url+'"',vKey=!1===key?"":' data-key="'+key+'"',btnDelete="",btnUpload="",btnDownload="",btnZoom="",btnDrag="",template=self._getLayoutTemplate("actions"),config=self.fileActionSettings,otherButtons=self.otherActionButtons.setTokens({dataKey:vKey,key:key}),removeClass=disabled?config.removeClass+" disabled":config.removeClass;return showDel&&(btnDelete=self._getLayoutTemplate("actionDelete").setTokens({removeClass:removeClass,removeIcon:config.removeIcon,removeTitle:config.removeTitle,dataUrl:vUrl,dataKey:vKey,key:key})),showUpl&&(btnUpload=self._getLayoutTemplate("actionUpload").setTokens({uploadClass:config.uploadClass,uploadIcon:config.uploadIcon,uploadTitle:config.uploadTitle})),showDwn&&(btnDownload=(btnDownload=self._getLayoutTemplate("actionDownload").setTokens({downloadClass:config.downloadClass,downloadIcon:config.downloadIcon,downloadTitle:config.downloadTitle,downloadUrl:dUrl||self.initialPreviewDownloadUrl})).setTokens({filename:dFile,key:key})),showZoom&&(btnZoom=self._getLayoutTemplate("actionZoom").setTokens({zoomClass:config.zoomClass,zoomIcon:config.zoomIcon,zoomTitle:config.zoomTitle})),showDrag&&isInit&&(css="drag-handle-init "+config.dragClass,btnDrag=self._getLayoutTemplate("actionDrag").setTokens({dragClass:css,dragTitle:config.dragTitle,dragIcon:config.dragIcon})),template.setTokens({delete:btnDelete,upload:btnUpload,download:btnDownload,zoom:btnZoom,drag:btnDrag,other:otherButtons})},_browse:function(e){var self=this;self._raise("filebrowse"),e&&e.isDefaultPrevented()||(self.isError&&!self.isUploadable&&self.clear(),self.$captionContainer.focus())},_filterDuplicate:function(file,files,fileIds){var fileId=this._getFileId(file);fileId&&fileIds&&fileIds.indexOf(fileId)>-1||(fileIds||(fileIds=[]),files.push(file),fileIds.push(fileId))},_change:function(e){var self=this,$el=self.$element;if(!self.isUploadable&&$h.isEmpty($el.val())&&self.fileInputCleared)self.fileInputCleared=!1;else{self.fileInputCleared=!1;var msg,total,n,len,tfiles=[],isDragDrop=arguments.length>1,isAjaxUpload=self.isUploadable,files=isDragDrop?e.originalEvent.dataTransfer.files:$el.get(0).files,ctr=self.filestack.length,flagSingle=$h.isEmpty($el.attr("multiple"))&&ctr>0,folders=0,fileIds=self._getFileIds();if(self.reader=null,self._resetUpload(),self._hideFileIcon(),self.isUploadable&&self.$container.find(".file-drop-zone ."+self.dropZoneTitleClass).remove(),isDragDrop?$.each(files,function(i,f){f&&!f.type&&void 0!==f.size&&f.size%4096==0?folders++:self._filterDuplicate(f,tfiles,fileIds)}):(files=e.target&&void 0===e.target.files?e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files||{},isAjaxUpload?$.each(files,function(i,f){self._filterDuplicate(f,tfiles,fileIds)}):tfiles=files),$h.isEmpty(tfiles)||0===tfiles.length)return isAjaxUpload||self.clear(),self._showFolderError(folders),void self._raise("fileselectnone");if(self._resetErrors(),len=tfiles.length,total=self._getFileCount(self.isUploadable?self.getFileStack().length+len:len),self.maxFileCount>0&&total>self.maxFileCount){if(!self.autoReplace||len>self.maxFileCount)return n=self.autoReplace&&len>self.maxFileCount?len:total,msg=self.msgFilesTooMany.replace("{m}",self.maxFileCount).replace("{n}",n),self.isError=function(mesg,file,previewId,index){var p1=$.extend(!0,{},self._getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self.isUploadable?self._showUploadError(mesg,p1):self._showError(mesg,p2)}(msg,null,null,null),self.$captionContainer.find(".kv-caption-icon").hide(),self._setCaption("",!0),void self.$container.removeClass("file-input-new file-input-ajax-new");total>self.maxFileCount&&self._resetPreviewThumbs(isAjaxUpload)}else!isAjaxUpload||flagSingle?(self._resetPreviewThumbs(!1),flagSingle&&self.clearStack()):!isAjaxUpload||0!==ctr||self.previewCache.count()&&!self.overwriteInitial||self._resetPreviewThumbs(!0);self.isPreviewable?self._readFiles(tfiles):self._updateFileDetails(1),self._showFolderError(folders)}},_abort:function(params){var data,self=this;return!(!self.ajaxAborted||"object"!=typeof self.ajaxAborted||void 0===self.ajaxAborted.message)&&(data=$.extend(!0,{},self._getOutData(),params),data.abortData=self.ajaxAborted.data||{},data.abortMessage=self.ajaxAborted.message,self._setProgress(101,self.$progress,self.msgCancelled),self._showUploadError(self.ajaxAborted.message,data,"filecustomerror"),self.cancel(),!0)},_resetFileStack:function(){var self=this,i=0,newstack=[],newnames=[],newids=[];self._getThumbs().each(function(){var newId,$thumb=$(this),ind=$thumb.attr("data-fileindex"),file=self.filestack[ind],pid=$thumb.attr("id");"-1"!==ind&&-1!==ind&&(void 0!==file?(newstack[i]=file,newnames[i]=self._getFileName(file),newids[i]=self._getFileId(file),$thumb.attr({id:self.previewInitId+"-"+i,"data-fileindex":i}),i++):(newId="uploaded-"+$h.uniqId(),$thumb.attr({id:newId,"data-fileindex":"-1"}),self.$preview.find("#zoom-"+pid).attr("id","zoom-"+newId)))}),self.filestack=newstack,self.filenames=newnames,self.fileids=newids},_isFileSelectionValid:function(cnt){var self=this;return cnt=cnt||0,self.required&&!self.getFilesCount()?(self.$errorContainer.html(""),self._showUploadError(self.msgFileRequired),!1):!(self.minFileCount>0&&self._getFileCount(cnt)<self.minFileCount)||(self._noFilesError({}),!1)},clearStack:function(){var self=this;return self.filestack=[],self.filenames=[],self.fileids=[],self.$element},updateStack:function(i,file){var self=this;return self.filestack[i]=file,self.filenames[i]=self._getFileName(file),self.fileids[i]=file&&self._getFileId(file)||null,self.$element},addToStack:function(file){var self=this;return self.filestack.push(file),self.filenames.push(self._getFileName(file)),self.fileids.push(self._getFileId(file)),self.$element},getFileStack:function(skipNull){return this.filestack.filter(function(n){return skipNull?void 0!==n:void 0!==n&&null!==n})},getFilesCount:function(){var self=this,len=self.isUploadable?self.getFileStack().length:self.$element.get(0).files.length;return self._getFileCount(len)},lock:function(){var self=this;return self._resetErrors(),self.disable(),self.showRemove&&self.$container.find(".fileinput-remove").hide(),self.showCancel&&self.$container.find(".fileinput-cancel").show(),self._raise("filelock",[self.filestack,self._getExtraData()]),self.$element},unlock:function(reset){var self=this;return void 0===reset&&(reset=!0),self.enable(),self.showCancel&&self.$container.find(".fileinput-cancel").hide(),self.showRemove&&self.$container.find(".fileinput-remove").show(),reset&&self._resetFileStack(),self._raise("fileunlock",[self.filestack,self._getExtraData()]),self.$element},cancel:function(){var i,self=this,xhr=self.ajaxRequests,len=xhr.length;if(len>0)for(i=0;i<len;i+=1)self.cancelling=!0,xhr[i].abort();return self._setProgressCancelled(),self._getThumbs().each(function(){var $thumb=$(this),ind=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[ind]&&($thumb.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),$thumb.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),self.unlock()}),self.$element},clear:function(){var cap,self=this;if(self._raise("fileclear"))return self.$btnUpload.removeAttr("disabled"),self._getThumbs().find("video,audio,img").each(function(){$h.cleanMemory($(this))}),self._resetUpload(),self.clearStack(),self._clearFileInput(),self._resetErrors(!0),self._hasInitialPreview()?(self._showFileIcon(),self._resetPreview(),self._initPreviewActions(),self.$container.removeClass("file-input-new")):(self._getThumbs().each(function(){self._clearObjects($(this))}),self.isUploadable&&(self.previewCache.data={}),self.$preview.html(""),cap=!self.overwriteInitial&&self.initialCaption.length>0?self.initialCaption:"",self.$caption.html(cap),self.$caption.attr("title",""),$h.addCss(self.$container,"file-input-new"),self._validateDefaultPreview()),0===self.$container.find($h.FRAMES).length&&(self._initCaption()||self.$captionContainer.find(".kv-caption-icon").hide()),self._hideFileIcon(),self._raise("filecleared"),self.$captionContainer.focus(),self._setFileDropZoneTitle(),self.$element},reset:function(){var self=this;if(self._raise("filereset"))return self._resetPreview(),self.$container.find(".fileinput-filename").text(""),$h.addCss(self.$container,"file-input-new"),(self.getFrames().length||self.isUploadable&&self.dropZoneEnabled)&&self.$container.removeClass("file-input-new"),self.clearStack(),self.formdata={},self._setFileDropZoneTitle(),self.$element},disable:function(){var self=this;return self.isDisabled=!0,self._raise("filedisabled"),self.$element.attr("disabled","disabled"),self.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),self.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),$h.addCss(self.$container.find(".btn-file"),"disabled"),self._initDragDrop(),self.$element},enable:function(){var self=this;return self.isDisabled=!1,self._raise("fileenabled"),self.$element.removeAttr("disabled"),self.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),self.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),self.$container.find(".btn-file").removeClass("disabled"),self._initDragDrop(),self.$element},upload:function(){var i,outData,len,self=this,totLen=self.getFileStack().length,hasExtraData=!$.isEmptyObject(self._getExtraData());if(self.isUploadable&&!self.isDisabled&&self._isFileSelectionValid(totLen))if(self._resetUpload(),0!==totLen||hasExtraData)if(self.$progress.show(),self.uploadCount=0,self.uploadStatus={},self.uploadLog=[],self.lock(),self._setProgress(2),0===totLen&&hasExtraData)self._uploadExtraOnly();else{if(len=self.filestack.length,self.hasInitData=!1,!self.uploadAsync)return self._uploadBatch(),self.$element;for(outData=self._getOutData(),self._raise("filebatchpreupload",[outData]),self.fileBatchCompleted=!1,self.uploadCache={content:[],config:[],tags:[],append:!0},self.uploadAsyncCount=self.getFileStack().length,i=0;i<len;i++)self.uploadCache.content[i]=null,self.uploadCache.config[i]=null,self.uploadCache.tags[i]=null;for(self.$preview.find(".file-preview-initial").removeClass($h.SORT_CSS),self._initSortable(),self.cacheInitialPreview=self.getPreview(),i=0;i<len;i++)self.filestack[i]&&self._uploadSingle(i,!0)}else self._showUploadError(self.msgUploadEmpty)},destroy:function(){var self=this,$form=self.$form,$cont=self.$container,$el=self.$element,ns=self.namespace;return $(document).off(ns),$(window).off(ns),$form&&$form.length&&$form.off(ns),self.isUploadable&&self._clearFileInput(),self._cleanup(),self._initPreviewCache(),$el.insertBefore($cont).off(ns).removeData(),$cont.off().remove(),$el},refresh:function(options,triggerChange){var self=this,$el=self.$element;return options="object"!=typeof options||$h.isEmpty(options)?self.options:$.extend(!0,{},self.options,options),self._init(options,!0),self._listen(),triggerChange&&$el.trigger("change"+self.namespace),$el},zoom:function(frameId){var self=this,$frame=self._getFrame(frameId),$modal=self.$modal;$frame&&($h.initModal($modal),$modal.html(self._getModalContent()),self._setZoomContent($frame),$modal.modal("show"),self._initZoomButtons())},getExif:function(frameId){var $frame=this._getFrame(frameId);return $frame&&$frame.data("exif")||null},getFrames:function(cssFilter){var self=this;return cssFilter=cssFilter||"",self.$preview.find($h.FRAMES+cssFilter)},getPreview:function(){var self=this;return{content:self.initialPreview,config:self.initialPreviewConfig,tags:self.initialPreviewThumbTags}}},$.fn.fileinput=function(option){if($h.hasFileAPISupport()||$h.isIE(9)){var args=Array.apply(null,arguments),retvals=[];switch(args.shift(),this.each(function(){var opt,self=$(this),data=self.data("fileinput"),options="object"==typeof option&&option,theme=options.theme||self.data("theme"),l={},t={},lang=options.language||self.data("language")||$.fn.fileinput.defaults.language||"en";data||(theme&&(t=$.fn.fileinputThemes[theme]||{}),"en"===lang||$h.isEmpty($.fn.fileinputLocales[lang])||(l=$.fn.fileinputLocales[lang]||{}),opt=$.extend(!0,{},$.fn.fileinput.defaults,t,$.fn.fileinputLocales.en,l,options,self.data()),data=new FileInput(this,opt),self.data("fileinput",data)),"string"==typeof option&&retvals.push(data[option].apply(data,args))}),retvals.length){case 0:return this;case 1:return retvals[0];default:return retvals}}},$.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,autoOrientImage:!0,required:!1,rtl:!1,hideThumbnailContent:!1,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,initialPreviewDownloadUrl:"",removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-secondary btn-header-toggle",fullscreen:"btn btn-default btn-secondary",borderless:"btn btn-default btn-secondary",close:"btn btn-default btn-secondary"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default btn-secondary",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default btn-secondary",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default btn-secondary",uploadUrl:null,uploadUrlThumb:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<button class="close kv-error-close">&times;</button>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0,mergeAjaxCallbacks:!1,mergeAjaxDeleteCallbacks:!1,retryErrorUploads:!0},$.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}},$.fn.fileinput.Constructor=FileInput,$(document).ready(function(){var $input=$("input.file[type=file]");$input.length&&$input.fileinput()})});